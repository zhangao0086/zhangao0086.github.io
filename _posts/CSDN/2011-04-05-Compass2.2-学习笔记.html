---
layout: post
title: "Compass2.2 学习笔记"
date: 2011-04-05 15:01:00
categories: [Java]
---


<p>学习Compass是个很快速的过程,它不像其他框架需要花很多时间学习它的API和了解它的工作流程.似乎Compass就是两个框架的组合版本.</p><p>为什么这样说呢?看下它的工作流程就知道了:</p><p><a target=_blank href="http://hi.csdn.net/attachment/201104/5/0_130198686906vJ.gif"><img title="Compass" src="http://hi.csdn.net/attachment/201104/5/0_1301986873uVkV.gif" border="0" alt="Compass" width="700" height="230" style="border-right-width:0px; padding-left:0px; padding-right:0px; display:inline; border-top-width:0px; border-bottom-width:0px; border-left-width:0px; padding-top:0px" /></a></p><p>这个结构和Hibernate很相像,无非就是Hibernate把JDBC封装了一把.所以从结构上来说,只要我们了解了Hibernate,就已经对Compass有了了解.那么Hibernate需要提供API和配置文件来对JDBC进行操作,那么Compass呢?Compass不仅从结构上模仿了Hibernate,就连API风格也不尽相同.我们把它和Hibernate的API做个对比就知道了:</p><p><img src="http://my.csdn.net/uploads/201206/14/1339662461_8065.png" width="770" height="160" alt="" /></p><p>再把两个session的核心方法比较一下:</p><table border="1" cellspacing="0" cellpadding="2" style="width:579px"><tbody><tr height="30"><td width="192" valign="top"><strong><span style="color:#ff0000">Hibernate session API</span></strong></td><td width="205" valign="top"><strong><span style="color:#ff0000">CompassSession API</span></strong></td><td width="180" valign="top">&nbsp;</td></tr><tr><td width="192" valign="top">save(Object)</td><td width="205" valign="top">create(Object)</td><td width="180" valign="top">建立索引</td></tr><tr><td width="192" valign="top">saveOrUpdate(Object)</td><td width="205" valign="top">save(Object)</td><td width="180" valign="top">保存或更新</td></tr><tr><td width="192" valign="top">delete(Object)</td><td width="205" valign="top">delete(Class, ids...)</td><td width="180" valign="top">删除索引</td></tr><tr><td width="192" valign="top">get()</td><td width="205" valign="top">get()</td><td width="180" valign="top">获取</td></tr><tr><td width="192" valign="top">createQuery(hql).list()</td><td width="205" valign="top">find(String)</td><td width="180" valign="top">使用查询字符串查询</td></tr></tbody></table><p>所以说,Compass与Hibernate极为相似,Compass总结起来就两句话:</p><li>Hibernate的风格 </li><li>Lucene的思想<p>Compass2.2的版本所用的Lucene2.4.1,Lucene2.4与目前的Lucene3.0相比:</p></li><li>API的差别很大，代码不能通用 </li><li>3.0效率更高<p>但是Compass用起来舒服,学习成本不高,所以这里用Compass2.2对索引库进行操作.</p><p><strong>所需jar包</strong></p><p><a target=_blank href="http://hi.csdn.net/attachment/201104/5/0_130198687355Hw.gif"><img title="image" src="http://hi.csdn.net/attachment/201104/5/0_1301986873T04n.gif" border="0" alt="image" width="186" height="197" style="border-right-width:0px; padding-left:0px; padding-right:0px; display:inline; border-top-width:0px; border-bottom-width:0px; border-left-width:0px; padding-top:0px" /></a></p><p><strong>Compass配置文件</strong></p><p>先从Compass的文档中复制配置模板:</p><p>&nbsp;</p><p>再对其进行详细配置:</p><div id="codeSnippetWrapper" style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:20px 0px 10px; width:99%; font-family:'Courier New',courier,monospace; direction:ltr; font-size:10pt; overflow:auto; border:silver 1px solid; padding:4px"><div id="codeSnippet" style="text-align:left; line-height:12pt; background-color:#f4f4f4; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#0000ff">&lt;</span><span style="color:#800000">compass</span> <span style="color:#ff0000">name</span><span style="color:#0000ff">=&quot;default&quot;</span><span style="color:#0000ff">&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">&nbsp;</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">&lt;!-- 1，连接信息 --&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">&lt;</span><span style="color:#800000">connection</span><span style="color:#0000ff">&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        <span style="color:#0000ff">&lt;</span><span style="color:#800000">file</span> <span style="color:#ff0000">path</span><span style="color:#0000ff">=&quot;./indexDir/&quot;</span> <span style="color:#0000ff">/&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">&lt;/</span><span style="color:#800000">connection</span><span style="color:#0000ff">&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">&nbsp;</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">&lt;!-- 2，声明映射信息 --&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">&lt;</span><span style="color:#800000">mappings</span><span style="color:#0000ff">&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        <span style="color:#0000ff">&lt;</span><span style="color:#800000">class</span> <span style="color:#ff0000">name</span><span style="color:#0000ff">=&quot;cn.domain.Article&quot;</span> <span style="color:#0000ff">/&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">&lt;/</span><span style="color:#800000">mappings</span><span style="color:#0000ff">&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">&nbsp;</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#0000ff">&lt;/</span><span style="color:#800000">compass</span><span style="color:#0000ff">&gt;</span></pre></div></div><p>在Lucene里面,如果将对象的数据存储在索引库里面,需要先把对象转换为Document,这个工作在Compass里面会自动将其转为Document,在Lucene里面还需要指定哪些Field是可以搜索的,并且是否存储在缓存数据里面,那么Compass也要提供相应的配置才行,Compass如何做到呢?它会在主配置文件(compass.cfg.xml)中通过反射得到Class,得到该类上所有的注解信息,这就是<span style="color:#ff0000"><strong>映射信息</strong></span>的作用.用Article作为测试类,属性如下:</p><div id="codeSnippetWrapper" style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:20px 0px 10px; width:99%; font-family:'Courier New',courier,monospace; direction:ltr; font-size:10pt; overflow:auto; border:silver 1px solid; padding:4px"><div id="codeSnippet" style="text-align:left; line-height:12pt; background-color:#f4f4f4; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> Article {</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    </pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">private</span> Integer id;</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">private</span> String title;</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">private</span> String content;</pre></div></div><p>再生成对应的getter、setter方法,我们要指明这个类的数据是可以被搜索到的,需要在类上添加注解:</p><div id="codeSnippetWrapper" style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:20px 0px 10px; width:99%; font-family:'Courier New',courier,monospace; direction:ltr; font-size:10pt; overflow:auto; border:silver 1px solid; padding:4px"><div id="codeSnippet" style="text-align:left; line-height:12pt; background-color:#f4f4f4; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">@Searchable</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> Article {</pre></div></div><p>这就表明这是一个<span style="color:#ff0000"><strong>可搜索对象</strong></span>,Compass会通过反射创造出该类的实例,所以一定要有<span style="color:#ff0000"><strong>无参的构造函数</strong></span>,并且有删除索引的需求,还有Field的配置等,对可搜索对象的所有要求为:</p><p>要有默认的构造方法</p></li><li>在类上要有：@Searchable </li><li>要有一个唯一标识符的属性:@SearchableId </li><li>其他的属性用:@SearchableProperty<p>第二个条件主要是针对删除和更新的,因为之前对Compass的核心方法和Hibernate的核心方法进行了对比,删除索引是用delete()方法,delete()方法不是接收一个对象,因为你把对象给它,它也不知道对象与与对象之间是以什么为区别的,所以给它一个Class,它通过在主配置文件中的映射信息,反射出该类, 再用你提供的第二个参数,也就是唯一标识符,来找到索引,从而进行删除和更新的操作,这就是<span style="color:#ff0000"><strong>@SearchableId的作用</strong></span>.</p><p>在Lucene里面将对象转为Document对象的时候,需要保存的数据用Field对象来封装,封装的时候,要提供是否存储数据以及是否为数据建立索引等配置,这就是<span style="color:#ff0000"><strong>@SearchableProperty的作用</strong></span>.完整的对类的配置为下,以id作为唯一标识符:</p><div id="codeSnippetWrapper" style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:20px 0px 10px; width:99%; font-family:'Courier New',courier,monospace; direction:ltr; font-size:10pt; overflow:auto; border:silver 1px solid; padding:4px"><div id="codeSnippet" style="text-align:left; line-height:12pt; background-color:#f4f4f4; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">@Searchable</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> Article {</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    </pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// 对于唯一标识符，默认不可以进行搜索，除非明确的指定name属性。</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// Compass2.2对于数字是使用toString()策略，对于数字属性应指定format属性。</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// 如format=&quot;00000&quot;，表示数字存为5个字符，如果不足5个，前面用若干个0补齐。</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    @SearchableId(name = <span style="color:#006080">&quot;id&quot;</span>, format = <span style="color:#006080">&quot;00000000&quot;</span>)</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">private</span> Integer id;</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    </pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// name属性可以不写，默认当前属性（成员变量）的名称。</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    @SearchableProperty(name = <span style="color:#006080">&quot;title&quot;</span>, store = Store.YES, index = Index.ANALYZED)</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">private</span> String title;</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    </pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    @SearchableProperty(name = <span style="color:#006080">&quot;content&quot;</span>, store = Store.YES, index = Index.ANALYZED)</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">private</span> String content;</pre></div></div><p>注意导包不要导错了,全是<strong><span style="color:#ff0000">org.compass.annotations</span></strong>包中的.属性配置基本和Lucene里面一样.唯一需要注意的就是对数字的处理.如果在Compass的使用过程中出来问题,或者找不到索引之类的,一定要记得看你的数据类型.</p><p>创建索引的方式基本与Lucene相同,毕竟Compass是对Lucene的封装,思想是属于Lucene的.就像Hibernate使用Session需要先得到SessionFactory一样,Compass也需要获得SessionFactory,并且也是由Configuration对象来取得的:</p><div id="codeSnippetWrapper" style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:20px 0px 10px; width:99%; font-family:'Courier New',courier,monospace; direction:ltr; font-size:10pt; overflow:auto; border:silver 1px solid; padding:4px"><div id="codeSnippet" style="text-align:left; line-height:12pt; background-color:#f4f4f4; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> ArticleDao {</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    </pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">private</span> Compass compassSessionFactory;</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    </pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">public</span> ArticleDao() {</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        CompassConfiguration cfg = <span style="color:#0000ff">new</span> CompassConfiguration().configure();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        compassSessionFactory = cfg.configure().buildCompass();</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    }</pre></div></div><p>在Hibernate中,对于Session,SessionFactory只需要一个就够了,对于一个索引库,全局只有一个Compass对象就可以了:</p><div id="codeSnippetWrapper" style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:20px 0px 10px; width:99%; font-family:'Courier New',courier,monospace; direction:ltr; font-size:10pt; overflow:auto; border:silver 1px solid; padding:4px"><div id="codeSnippet" style="text-align:left; line-height:12pt; background-color:#f4f4f4; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">@Test</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#0000ff">public</span> <span style="color:#0000ff">void</span> createIndex(){</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">//准备好测试数据</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    Article article = <span style="color:#0000ff">new</span> Article();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    article.setId(1);</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    article.setTitle(<span style="color:#006080">&quot;baby&quot;</span>);</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    article.setContent(<span style="color:#006080">&quot;love you&quot;</span>);</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    </pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">//获得Session</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassSession session = compassSessionFactory.openSession();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">//这个事务是针对索引库的事务</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassTransaction tx = session.beginTransaction();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    session.save(article);</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    tx.commit();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    session.close();    <span style="color:#008000">//一定要记得关闭</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">}</pre></div></div><p>简单的查询,就像Lucene的查询字符串一样.</p><div id="codeSnippetWrapper" style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:20px 0px 10px; width:99%; font-family:'Courier New',courier,monospace; direction:ltr; font-size:10pt; overflow:auto; border:silver 1px solid; padding:4px"><div id="codeSnippet" style="text-align:left; line-height:12pt; background-color:#f4f4f4; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">@Test</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#0000ff">public</span> <span style="color:#0000ff">void</span> searchIndex() {</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">//获得Session</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassSession session = compassSessionFactory.openSession();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">//这个事务是针对索引库的事务</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassTransaction tx = session.beginTransaction();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">//找到一条结果数</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">//        Article article = session.load(Article.class, 1);</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">//        System.out.println(article.getId());</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">//        System.out.println(article.getTitle());</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">//        System.out.println(article.getContent());</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    String queryString = <span style="color:#006080">&quot;love&quot;</span>;</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassHits hits = session.find(queryString);</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">int</span> count = hits.length();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">for</span> (<span style="color:#0000ff">int</span> i = 0; i &lt; count; i++) {</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        Article article = (Article) hits.data(i);</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        System.out.println(article.getId());</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        System.out.println(article.getTitle());</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        System.out.println(article.getContent());</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    }</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    tx.commit();</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    session.close(); <span style="color:#008000">//一定要记得关闭</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">}</pre></div></div><p>这只是一个简单增加索引和查询索引的例子,权当做<strong><span style="color:#ff0000">Hello World</span></strong>吧.</p><p>每次使用Session都要从SessionFactory中获取,无疑是很麻烦的,不如把SessionFactory维护在工具类里面,全局只有一个,在用一个静态方法得到一个Session.</p><div id="codeSnippetWrapper" style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:20px 0px 10px; width:99%; font-family:'Courier New',courier,monospace; direction:ltr; font-size:10pt; overflow:auto; border:silver 1px solid; padding:4px"><div id="codeSnippet" style="text-align:left; line-height:12pt; background-color:#f4f4f4; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">@Test</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#0000ff">public</span> <span style="color:#0000ff">void</span> deleteIndex(){</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassSession session = CompassUtils.getSession();</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassTransaction tx = session.beginTransaction();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    session.delete(Article.<span style="color:#0000ff">class</span>,1);</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    tx.commit();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    session.close();</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">}</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">&nbsp;</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">@Test</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#0000ff">public</span> <span style="color:#0000ff">void</span> updateIndex(){</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassSession session = CompassUtils.getSession();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassTransaction tx = session.beginTransaction();</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    Article article = session.get(Article.<span style="color:#0000ff">class</span>, 1);</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    article.setContent(<span style="color:#006080">&quot;love love&quot;</span>);</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    session.save(article);</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    tx.commit();</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    session.close();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">}</pre></div></div><p><strong><span style="color:#ff0000">注意,如果唯一标识符是数字,并且没有在实体类里面对唯一标识符使用format属性,则以上代码获取不到!</span></strong></p><p>&nbsp;</p><hr /><p>默认的分词是<strong><span style="color:#ff0000">标准分词器</span></strong>,这个分词器对中文采取的是<strong><span style="color:#ff0000">单字分词</span></strong>,根本没办法使用.一般做法是用第三方的分词器,常用的有极易分词、庖丁分词、IKAnalyzer等.要使用分词器,需要在Compass的主配置文件里面进行配置,这里采用极易分词:</p><div id="codeSnippetWrapper" style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:20px 0px 10px; width:99%; font-family:'Courier New',courier,monospace; direction:ltr; font-size:10pt; overflow:auto; border:silver 1px solid; padding:4px"><div id="codeSnippet" style="text-align:left; line-height:12pt; background-color:#f4f4f4; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#008000">&lt;!-- 3，其他配置 --&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#0000ff">&lt;</span><span style="color:#800000">settings</span><span style="color:#0000ff">&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">&lt;!-- 配置分词器类型 --&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">&lt;</span><span style="color:#800000">setting</span> <span style="color:#ff0000">name</span><span style="color:#0000ff">=&quot;compass.engine.analyzer.default.type&quot;</span> <span style="color:#ff0000">value</span><span style="color:#0000ff">=&quot;jeasy.analysis.MMAnalyzer&quot;</span><span style="color:#0000ff">&gt;&lt;/</span><span style="color:#800000">setting</span><span style="color:#0000ff">&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#0000ff">&lt;/</span><span style="color:#800000">settings</span><span style="color:#0000ff">&gt;</span></pre></div></div><p>这个分词器对中文支持比较好,采用的是词库分词,准确度较高.</p><p>&nbsp;</p><hr /><p>接下来还要配置<strong><span style="color:#ff0000">高亮器</span></strong>,配置高亮器主要有三点:前缀、后缀、高亮显示的摘要.同样是在主配置文件里面进行配置:</p><div id="codeSnippetWrapper" style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:20px 0px 10px; width:99%; font-family:'Courier New',courier,monospace; direction:ltr; font-size:10pt; overflow:auto; border:silver 1px solid; padding:4px"><div id="codeSnippet" style="text-align:left; line-height:12pt; background-color:#f4f4f4; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#008000">&lt;!-- 3，其他配置 --&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#0000ff">&lt;</span><span style="color:#800000">settings</span><span style="color:#0000ff">&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">&lt;!-- 高亮配置：摘要的长度（字符数量，默认为100） --&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">&lt;</span><span style="color:#800000">setting</span> <span style="color:#ff0000">name</span><span style="color:#0000ff">=&quot;compass.engine.highlighter.default.fragmenter.simple.size&quot;</span> <span style="color:#ff0000">value</span><span style="color:#0000ff">=&quot;20&quot;</span> <span style="color:#0000ff">/&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">&lt;!-- 高亮配置：显示效果的前缀 --&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">&lt;</span><span style="color:#800000">setting</span> <span style="color:#ff0000">name</span><span style="color:#0000ff">=&quot;compass.engine.highlighter.default.formatter.simple.pre&quot;</span> <span style="color:#ff0000">value</span><span style="color:#0000ff">=&quot;&amp;lt;span class='keyword'&amp;gt;&quot;</span> <span style="color:#0000ff">/&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">&lt;!-- 高亮配置：显示效果的后缀 --&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">&lt;</span><span style="color:#800000">setting</span> <span style="color:#ff0000">name</span><span style="color:#0000ff">=&quot;compass.engine.highlighter.default.formatter.simple.post&quot;</span> <span style="color:#ff0000">value</span><span style="color:#0000ff">=&quot;&amp;lt;/span&amp;gt;&quot;</span> <span style="color:#0000ff">/&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    </pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">&lt;!-- 配置分词器类型 --&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">&lt;</span><span style="color:#800000">setting</span> <span style="color:#ff0000">name</span><span style="color:#0000ff">=&quot;compass.engine.analyzer.default.type&quot;</span> <span style="color:#ff0000">value</span><span style="color:#0000ff">=&quot;jeasy.analysis.MMAnalyzer&quot;</span><span style="color:#0000ff">&gt;&lt;/</span><span style="color:#800000">setting</span><span style="color:#0000ff">&gt;</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#0000ff">&lt;/</span><span style="color:#800000">settings</span><span style="color:#0000ff">&gt;</span></pre></div></div><p><strong><span style="color:#ff0000">注意,前缀和后缀中的标签,要转义,不然会和配置文件中的符号产生冲突!</span></strong></p><div id="codeSnippetWrapper" style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:20px 0px 10px; width:99%; font-family:'Courier New',courier,monospace; direction:ltr; font-size:10pt; overflow:auto; border:silver 1px solid; padding:4px"><div id="codeSnippet" style="text-align:left; line-height:12pt; background-color:#f4f4f4; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">@Test</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#0000ff">public</span> <span style="color:#0000ff">void</span> highlighterIndex() {</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassSession session = CompassUtils.getSession();</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassTransaction tx = session.beginTransaction();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// 查询条件</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    String queryString = <span style="color:#006080">&quot;love&quot;</span>;</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassHits hits = session.find(queryString);</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">int</span> count = hits.length();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">for</span> (<span style="color:#0000ff">int</span> i = 0; i &lt; count; i++) {</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        Article article = (Article) hits.data(i);</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        <span style="color:#008000">// -------------------------</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        <span style="color:#008000">// 进行高亮操作，一次高亮一个属性值</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">&nbsp; <span style="color:#008000">// 返回高亮后的一段文本摘要，原属性值不会改变</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">&nbsp;&nbsp; <span style="color:#008000">// 如果当前高亮的属性值中没有出现关键字，则返回null.</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        String text = hits.highlighter(i).fragment(<span style="color:#006080">&quot;content&quot;</span>);</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        <span style="color:#0000ff">if</span>(text != null){</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">            <span style="color:#008000">// 使用的高亮后的文本替原文本</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">            article.setContent(text);</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        }</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        System.out.println(article.getId());</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        System.out.println(article.getTitle());</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        System.out.println(article.getContent());</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    }</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    tx.commit();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    session.close();</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">}</pre></div></div><p>一般来说搜索结果的排序和Lucene里面是一样的,按照<strong><span style="color:#ff0000">相关度得分</span></strong>进行排序,在实际应用中,往往需要人工操纵得分,比如给了推广费之类的,既然有这种需求,自然就有这种做法,和Lucene的不同之处在于,Lucene在<strong><span style="color:#ff0000">添加索引时</span></strong>控制相关度得分的比重,Compass也是在添加索引时控制,不过需要在实体类里面增加一个属性和它的getter、setter方法,这个属性决定了所有这个类的数据的相关度得分的比重,也就是说可以让只要是这个实体类的数据,就能比别的类的数据得分要高,并且只要是设置了这个属性,就能在添加索引时控制相关度得分的比重:</p><div id="codeSnippetWrapper" style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:20px 0px 10px; width:99%; font-family:'Courier New',courier,monospace; direction:ltr; font-size:10pt; overflow:auto; border:silver 1px solid; padding:4px"><div id="codeSnippet" style="text-align:left; line-height:12pt; background-color:#f4f4f4; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">@SearchableBoostProperty</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#0000ff">private</span> <span style="color:#0000ff">float</span> boostValue = 1F;</pre></div></div><p>在实体里面增加这个属性,属性名无所谓,类型是<strong><span style="color:#ff0000">float</span></strong>,最重要的是要有<strong><span style="color:#ff0000">getter、setter方法和@SearchableBoostProperty</span></strong>,必须要有这处注解,Lucene才能在你调用相关方法的时候,通过反射获得有这个注解的属性名,在调用它的getter方法,得到值,那么在程序中就要增加一句代码:</p><div id="codeSnippetWrapper" style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:20px 0px 10px; width:99%; font-family:'Courier New',courier,monospace; direction:ltr; font-size:10pt; overflow:auto; border:silver 1px solid; padding:4px"><div id="codeSnippet" style="text-align:left; line-height:12pt; background-color:#f4f4f4; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#008000">//准备好测试数据</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">Article article = <span style="color:#0000ff">new</span> Article();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">article.setId(3);</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">article.setTitle(<span style="color:#006080">&quot;baby&quot;</span>);</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">article.setContent(<span style="color:#006080">&quot;love you&quot;</span>);</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#008000">//设定比重,默认为1L</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">article.setBoostValue(2L);</pre></div></div><p>其他地方都是一样的.除了对相关度得分的排序以外,还可能在搜索时使用某个属性的值进行排序.这也是可以的:</p><div id="codeSnippetWrapper" style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:20px 0px 10px; width:99%; font-family:'Courier New',courier,monospace; direction:ltr; font-size:10pt; overflow:auto; border:silver 1px solid; padding:4px"><div id="codeSnippet" style="text-align:left; line-height:12pt; background-color:#f4f4f4; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">@Test</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#0000ff">public</span> <span style="color:#0000ff">void</span> sortIndex() {</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassSession session = CompassUtils.getSession();</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassTransaction tx = session.beginTransaction();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// 查询条件</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    String queryString = <span style="color:#006080">&quot;love&quot;</span>;</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">//CompassHits hits = session.find(queryString);</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassQuery query = session.queryBuilder().queryString(queryString).toQuery();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    query.addSort(<span style="color:#006080">&quot;id&quot;</span>);</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassHits hits = query.hits();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">int</span> count = hits.length();</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">for</span> (<span style="color:#0000ff">int</span> i = 0; i &lt; count; i++) {</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        Article article = (Article) hits.data(i);</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        System.out.println(article.getId());</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        System.out.println(article.getTitle());</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        System.out.println(article.getContent());</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    }</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    tx.commit();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    session.close();</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">}</pre></div></div><p>只需要在得到搜索结果之前做一点改动.先得到CompassQuery对象,调用这个对象的addSort()方法增加排序规则.像上述一样,则是按升序进行排序,也可以替换成下面这句使用降序排列:</p><div id="codeSnippetWrapper" style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:20px 0px 10px; width:99%; font-family:'Courier New',courier,monospace; direction:ltr; font-size:10pt; overflow:auto; border:silver 1px solid; padding:4px"><div id="codeSnippet" style="text-align:left; line-height:12pt; background-color:#f4f4f4; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">query.addSort(<span style="color:#006080">&quot;id&quot;</span>,SortDirection.REVERSE);</pre></div></div><p><strong><span style="color:#ff0000">注意,指定参与排序的字段时,参与排序的字段必须要是Index.NOT_ANALYZED,否则分词后无法找到!</span></strong></p><p>有时候也会使用到<strong><span style="color:#ff0000">过滤器</span></strong>对搜索结果进行过滤.</p><div id="codeSnippetWrapper" style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:20px 0px 10px; width:99%; font-family:'Courier New',courier,monospace; direction:ltr; font-size:10pt; overflow:auto; border:silver 1px solid; padding:4px"><div id="codeSnippet" style="text-align:left; line-height:12pt; background-color:#f4f4f4; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">@Test</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#0000ff">public</span> <span style="color:#0000ff">void</span> filterIndex() {</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassSession session = CompassUtils.getSession();</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassTransaction tx = session.beginTransaction();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">//查询条件</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    String queryString = <span style="color:#006080">&quot;love&quot;</span>;</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">//得到CompassQuery对象,准备查询</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassQuery query = session.queryBuilder().queryString(queryString).toQuery();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">/**</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#008000">     * 增加过滤条件,between第三、四个参数分别代表是否包含下边界和上边界</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#008000">     */</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassQueryFilter filter = session.queryFilterBuilder().between(<span style="color:#006080">&quot;id&quot;</span>, 2, 3, true, true);</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">//添加过滤器</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    query.setFilter(filter);</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassHits hits = query.hits();</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">int</span> count = hits.length();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">for</span> (<span style="color:#0000ff">int</span> i = 0; i &lt; count; i++) {</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        Article article = (Article) hits.data(i);</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        System.out.println(article.getId());</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        System.out.println(article.getTitle());</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        System.out.println(article.getContent());</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    }</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    tx.commit();</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    session.close();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">}</pre></div></div><p>但是使用过滤器是<strong><span style="color:#ff0000">效率很低</span></strong>的做法,使用查询字符串可以获得更高的效率,而且可以达到同样的效果.下面就对<span style="color:#ff0000"><strong>各种查询</strong></span>进行简要说明:</p><div id="codeSnippetWrapper" style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:20px 0px 10px; width:99%; font-family:'Courier New',courier,monospace; direction:ltr; font-size:10pt; overflow:auto; border:silver 1px solid; padding:4px"><div id="codeSnippet" style="text-align:left; line-height:12pt; background-color:#f4f4f4; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">@Test</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px"><span style="color:#0000ff">public</span> <span style="color:#0000ff">void</span> search() <span style="color:#0000ff">throws</span> Exception {</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassSession session = CompassUtils.openSession();</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassTransaction tx = session.beginTransaction();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">&nbsp;</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// 查询方式一：使用查询字符串（可以有查询语法）</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// CompassHits hits = session.find(queryString);</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// -----------------------------------------------------------------</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// 查询方式二：构建CompassQuery对象</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// 1，查询所有</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassQuery query1 = session.queryBuilder().matchAll();</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">&nbsp;</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// 2，关键词查询</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassQuery query2 = session.queryBuilder().term(<span style="color:#006080">&quot;title&quot;</span>, <span style="color:#006080">&quot;lucene&quot;</span>);</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">&nbsp;</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// 3，范围查询</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassQuery query3 = session.queryBuilder().between(<span style="color:#006080">&quot;id&quot;</span>, 5, 15, true);</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">&nbsp;</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// 4，通配符查询</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassQuery query4 = session.queryBuilder().wildcard(<span style="color:#006080">&quot;title&quot;</span>, <span style="color:#006080">&quot;lu*n?&quot;</span>);</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">&nbsp;</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// 5，短语查询</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// 设定精确间隔的匹配方式，写法1</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassMultiPhraseQueryBuilder qb = session.queryBuilder().multiPhrase(<span style="color:#006080">&quot;title&quot;</span>);</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    qb.add(<span style="color:#006080">&quot;lucene&quot;</span>, 0); <span style="color:#008000">// 第一个词位置从0开始</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    qb.add(<span style="color:#006080">&quot;工作&quot;</span>, 2); <span style="color:#008000">// 第二个词位置从2开始</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassQuery query5 = qb.toQuery();</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// 设定精确间隔的匹配方式，写法2</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassQuery query6 = session.queryBuilder().multiPhrase(<span style="color:#006080">&quot;title&quot;</span>)<span style="color:#008000">//</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">            .add(<span style="color:#006080">&quot;lucene&quot;</span>, 0) <span style="color:#008000">// 第一个词位置从0开始</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">            .add(<span style="color:#006080">&quot;工作&quot;</span>, 2) <span style="color:#008000">// 第二个词位置从2开始</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">            .toQuery();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// 设定最多间隔的匹配方式</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassQuery query7 = session.queryBuilder().multiPhrase(<span style="color:#006080">&quot;title&quot;</span>)<span style="color:#008000">//</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">            .add(<span style="color:#006080">&quot;lucene&quot;</span>) <span style="color:#008000">//</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">            .add(<span style="color:#006080">&quot;工作&quot;</span>) <span style="color:#008000">// </span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">            .setSlop(5) <span style="color:#008000">// 指定的词之间的最长间隔不超过5个词</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">            .toQuery();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// 6，布尔查询</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassQuery query = session.queryBuilder().bool()<span style="color:#008000">//</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">            <span style="color:#008000">// .addMust(query)</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">            <span style="color:#008000">// .addMustNot(query)</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">            <span style="color:#008000">// .addShould(query)</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">            .addMust(query1)<span style="color:#008000">//</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">            .addMustNot(query3)<span style="color:#008000">//</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">            .toQuery();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">&nbsp;</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// -------------------------------</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    CompassHits hits = query.hits();</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">&nbsp;</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// 处理结果</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    List&lt;Article&gt; list = <span style="color:#0000ff">new</span> ArrayList&lt;Article&gt;();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">int</span> count = hits.length(); <span style="color:#008000">// 总结果数</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">&nbsp;</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">for</span> (<span style="color:#0000ff">int</span> i = 0; i &lt; hits.length(); i++) {</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        Article article = (Article) hits.data(i);</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        list.add(article);</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    }</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">&nbsp;</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    tx.commit();</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    session.close();</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// -----------------------------------------------------------------</span></pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#008000">// 显示结果</span></pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    System.out.println(<span style="color:#006080">&quot;====== 符合条件的总记录数为：&quot;</span> + count + <span style="color:#006080">&quot; ======&quot;</span>);</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    <span style="color:#0000ff">for</span> (Article a : list) {</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        System.out.println(<span style="color:#006080">&quot;--------------&gt; id = &quot;</span> + a.getId());</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        System.out.println(<span style="color:#006080">&quot;title  = &quot;</span> + a.getTitle());</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">        System.out.println(<span style="color:#006080">&quot;content= &quot;</span> + a.getContent());</pre><pre style="text-align:left; line-height:12pt; background-color:white; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">    }</pre><pre style="text-align:left; line-height:12pt; background-color:#f4f4f4; margin:0em; width:100%; font-family:'Courier New',courier,monospace; direction:ltr; color:black; font-size:10pt; overflow:visible; border-style:none; padding:0px">}</pre></div></div><p>基本上还是Lucene的那一套,只是简单的封装一下而已.</p><hr /><p><br />如果本文有任何问题,请及时指出,以免对后来者产生不必要的困扰,不胜感激!</p></li>