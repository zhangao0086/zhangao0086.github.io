---
layout: post
title: 'iOS 自定义页面的切换动画与交互动画 By Swift'
date: 2014-08-11 17:30:48 +0800
categories: [iOS,Swift]
csdn_read_num: 43307
article_type: 1
---


<p>在iOS7之前，开发者为了寻求自定义Navigation Controller的Push/Pop动画，只能受限于子类化一个UINavigationController，或是用自定义的动画去覆盖它。但是随着iOS7的到来，Apple针对开发者推出了新的工具，以更灵活地方式管理UIViewController切换。</p><p><br /></p><p><span style="font-size:18px;">我把最终的Demo稍做修改，算是找了一个合适的应用场景，另外配上几张美图，拉拉人气<img alt="偷笑" src="http://static.blog.csdn.net/xheditor/xheditor_emot/default/titter.gif" />。</span></p><p><span style="font-size:18px;">虽然是Swift的Demo，但是转成Objective-C相当容易。</span></p><p><br /></p><h2>最终效果预览：</h2><div><img src="https://img-blog.csdn.net/20140814113049987" alt="" /><br /></div><h2>自定义导航栏的Push/Pop动画</h2><p>为了在基于UINavigationController下做自定义的动画切换，先建立一个简单的工程，这个工程的rootViewController是一个UINavigationController，UINavigationController的rootViewController是一个简单的UIViewController（称之为主页面），通过这个UIViewController上的一个Button能进入到下一个UIViewController中（称之为详情页面），我们先在主页面的ViewController上实现两个协议：UINavigationControllerDelegate和<strong><span style="color:#cc0000;">UIViewControllerAnimatedTransitioning</span></strong>，然后在ViewDidLoad里面把navigationController的delegate设为self，这样在导航栏Push和Pop的时候我们就知道了，然后用一个属性记下是Push还是Pop，就像这样：</p><p></p><div style="font-family: sans-serif; font-size: 16px; line-height: 110% !important; background-color: rgb(248, 248, 255) !important; border: 1px solid rgba(0, 0, 0, 0.14902) !important; padding: 8.5px !important; border-top-left-radius: 4px !important; border-top-right-radius: 4px !important; border-bottom-right-radius: 4px !important; border-bottom-left-radius: 4px !important;"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;"><span style="color: rgb(187, 44, 162);">func</span>&nbsp;navigationController(navigationController:&nbsp;<span style="color: rgb(112, 61, 170);">UINavigationController</span>!, animationControllerForOperation operation:&nbsp;<span style="color: rgb(112, 61, 170);">UINavigationControllerOperation</span>, fromViewController fromVC:&nbsp;<span style="color: rgb(112, 61, 170);">UIViewController</span>!, toViewController toVC:&nbsp;<span style="color: rgb(112, 61, 170);">UIViewController</span>!) -&gt;&nbsp;<span style="color: rgb(112, 61, 170);">UIViewControllerAnimatedTransitioning</span>! {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(79, 129, 135);">navigationOperation</span>&nbsp;= operation</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(187, 44, 162);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp;&nbsp;</span>return<span style="color: rgb(0, 0, 0);">&nbsp;</span>self</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">}</p></div><p></p><p>这是iOS7的新方法，这个方法需要你提供一个UIViewControllerAnimatedTransitioning，那<strong><span style="color:#cc0000;">UIViewControllerAnimatedTransitioning</span></strong>到底是什么呢？</p><p></p><p>UIViewControllerAnimatedTransitioning是苹果新增加的一个协议，其目的是在需要使用自定义动画的同时，又不影响视图的其他属性，让你把焦点集中在动画实现的本身上，然后通过在这个协议的回调里编写自定义的动画代码，即“切换中应该会发生什么”，负责切换的具体内容，任何实现了这一协议的对象被称之为<strong>动画控制器。</strong>你可以借助协议能被任何对象实现的这一特性，从而把各种动画效果封装到不同的类中，只要方便使用和管理，你可以发挥一切手段。我在这里让主页面实现动画控制器也是可以的，因为它是导航栏的rootViewController，会一直存在，我只要在里面编写自定义的Push和Pop动画代码就可以了：</p><p></p><p style="margin-top: 5px; margin-bottom: 5px; font-family: sans-serif; font-size: 16px;"><span style="font-family: Arial, Helvetica, sans-serif; font-size: 12px;"></span></p><div style="font-family: sans-serif; font-size: 16px; line-height: 110% !important; background-color: rgb(248, 248, 255) !important; border: 1px solid rgba(0, 0, 0, 0.14902) !important; padding: 8.5px !important; border-top-left-radius: 4px !important; border-top-right-radius: 4px !important; border-bottom-right-radius: 4px !important; border-bottom-left-radius: 4px !important;"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(0, 132, 0);">//UIViewControllerTransitioningDelegate</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(112, 61, 170);"><span style="color: rgb(187, 44, 162);">func</span><span style="color: rgb(0, 0, 0);">&nbsp;transitionDuration(transitionContext:&nbsp;</span>UIViewControllerContextTransitioning<span style="color: rgb(0, 0, 0);">!) -&gt;&nbsp;</span>NSTimeInterval<span style="color: rgb(0, 0, 0);">&nbsp;{</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(187, 44, 162);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp;&nbsp;</span>return<span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(39, 42, 216);">0.4</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">}</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;"><br /></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;"><span style="color: rgb(187, 44, 162);">func</span>&nbsp;animateTransition(transitionContext:&nbsp;<span style="color: rgb(112, 61, 170);">UIViewControllerContextTransitioning</span>!) {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">let</span>&nbsp;containerView = transitionContext.<span style="color: rgb(61, 29, 129);">containerView</span>()</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">let</span>&nbsp;toViewController = transitionContext.<span style="color: rgb(61, 29, 129);">viewControllerForKey</span>(<span style="color: rgb(112, 61, 170);">UITransitionContextToViewControllerKey</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">let</span>&nbsp;fromViewController = transitionContext.<span style="color: rgb(61, 29, 129);">viewControllerForKey</span>(<span style="color: rgb(112, 61, 170);">UITransitionContextFromViewControllerKey</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; min-height: 11px;">&nbsp;&nbsp; &nbsp;</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">var</span>&nbsp;destView:&nbsp;<span style="color: rgb(112, 61, 170);">UIView</span>!</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">var</span>&nbsp;destTransform:&nbsp;<span style="color: rgb(112, 61, 170);">CGAffineTransform</span>!</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(112, 61, 170);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(187, 44, 162);">if</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(79, 129, 135);">navigationOperation</span><span style="color: rgb(0, 0, 0);">&nbsp;==&nbsp;</span>UINavigationControllerOperation<span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(61, 29, 129);">Push</span><span style="color: rgb(0, 0, 0);">&nbsp;{</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; containerView.<span style="color: rgb(61, 29, 129);">insertSubview</span>(toViewController.<span style="color: rgb(112, 61, 170);">view</span>, aboveSubview: fromViewController.<span style="color: rgb(112, 61, 170);">view</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; destView = toViewController.<span style="color: rgb(112, 61, 170);">view</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(61, 29, 129);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp; destView.</span><span style="color: rgb(112, 61, 170);">transform</span><span style="color: rgb(0, 0, 0);">&nbsp;=&nbsp;</span>CGAffineTransformMakeScale<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(39, 42, 216);">0.1</span><span style="color: rgb(0, 0, 0);">,&nbsp;</span><span style="color: rgb(39, 42, 216);">0.1</span><span style="color: rgb(0, 0, 0);">)</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; destTransform =&nbsp;<span style="color: rgb(61, 29, 129);">CGAffineTransformMakeScale</span>(<span style="color: rgb(39, 42, 216);">1</span>,&nbsp;<span style="color: rgb(39, 42, 216);">1</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(112, 61, 170);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; }&nbsp;</span><span style="color: rgb(187, 44, 162);">else</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(187, 44, 162);">if</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(79, 129, 135);">navigationOperation</span><span style="color: rgb(0, 0, 0);">&nbsp;==&nbsp;</span>UINavigationControllerOperation<span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(61, 29, 129);">Pop</span><span style="color: rgb(0, 0, 0);">&nbsp;{</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; containerView.<span style="color: rgb(61, 29, 129);">insertSubview</span>(toViewController.<span style="color: rgb(112, 61, 170);">view</span>, belowSubview: fromViewController.<span style="color: rgb(112, 61, 170);">view</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; destView = fromViewController.<span style="color: rgb(112, 61, 170);">view</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(0, 132, 0);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>//&nbsp;<span style="font-family: 'Heiti SC Light';">如果</span>IDE<span style="font-family: 'Heiti SC Light';">是</span>Xcode6 Beta4+iOS8SDK<span style="font-family: 'Heiti SC Light';">，那么在此处设置为</span>0<span style="font-family: 'Heiti SC Light';">，动画将不会被执行</span>(<span style="font-family: 'Heiti SC Light';">不确定是哪里的</span>Bug)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; destTransform =&nbsp;<span style="color: rgb(61, 29, 129);">CGAffineTransformMakeScale</span>(<span style="color: rgb(39, 42, 216);">0.1</span>,&nbsp;<span style="color: rgb(39, 42, 216);">0.1</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; }</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(112, 61, 170);">UIView</span>.<span style="color: rgb(61, 29, 129);">animateWithDuration</span>(<span style="color: rgb(49, 89, 93);">transitionDuration</span>(transitionContext), animations: {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; destView.<span style="color: rgb(112, 61, 170);">transform</span>&nbsp;= destTransform</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; }, completion: ({completed&nbsp;<span style="color: rgb(187, 44, 162);">in</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; transitionContext.<span style="color: rgb(61, 29, 129);">completeTransition</span>(<span style="color: rgb(187, 44, 162);">true</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; }))</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">}</p></div><p></p><p style="margin-top: 5px; margin-bottom: 5px; font-family: sans-serif; font-size: 16px;"><span style="font-family: Arial, Helvetica, sans-serif; font-size: 12px;">上面第一个方法返回动画持续的时间，而下面这个方法才是具体需要实现动画的地方。UIViewControllerAnimatedTransitioning的协议都包含一个对象：transitionContext，通过这个对象能获取到切换时的上下文信息，比如从哪个VC切换到哪个VC等。我们从transitionContext获取containerView，这是一个特殊的容器，切换时的动画将在这个容器中进行；UITransitionContextFromViewControllerKey和UITransitionContextToViewControllerKey就是从哪个VC切换到哪个VC，容易理解；除此之外，还有直接获取view的UITransitionContextFromViewKey和UITransitionContextToViewKey等。</span></p><p>我按Push和Pop把动画简单的区分了一下，Push时scale由小变大，Pop时scale由大变小，不同的操作，toViewController的视图层次也不一样。最后，在动画完成的时候调用<strong><span style="color:#cc0000;">completeTransition</span></strong>，告诉transitionContext你的动画已经结束，这是非常重要的方法，<strong><span style="color:#cc0000;">必须调用</span></strong>。在动画结束时没有对containerView的子视图进行清理（比如把fromViewController的view移除掉）是因为transitionContext会自动清理，所以我们无须在额外处理。</p><p>注意一点，这样一来会发现原来导航栏的交互式返回效果没有了，如果你想用原来的交互式返回效果的话，在返回动画控制器的delegate方法里返回nil，如：</p><p></p><div style="font-family: sans-serif; font-size: 16px; line-height: 110% !important; background-color: rgb(248, 248, 255) !important; border: 1px solid rgba(0, 0, 0, 0.14902) !important; padding: 8.5px !important; border-top-left-radius: 4px !important; border-top-right-radius: 4px !important; border-bottom-right-radius: 4px !important; border-bottom-left-radius: 4px !important;"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(112, 61, 170);"><span style="color: rgb(187, 44, 162);">if</span><span style="color: rgb(0, 0, 0);">&nbsp;operation&nbsp;</span><span style="color: rgb(61, 29, 129);">==</span><span style="color: rgb(0, 0, 0);">&nbsp;</span>UINavigationControllerOperation<span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(61, 29, 129);">Push</span><span style="color: rgb(0, 0, 0);">&nbsp;{</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(79, 129, 135);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp;&nbsp;</span>navigationOperation<span style="color: rgb(0, 0, 0);">&nbsp;= operation</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(187, 44, 162);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp;&nbsp;</span>return<span style="color: rgb(0, 0, 0);">&nbsp;</span>self</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">}</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(187, 44, 162);">return<span style="color: rgb(0, 0, 0);">&nbsp;</span>nil</p></div><p></p>然后在viewDidLoad里，Objective-C直接self.navigationController.interactivePopGestureRecognizer.delegat ＝ self就行了，Swift除了要navigationController.interactivePopGestureRecognizer.delegate = self之外，还要在self上声明实现了UIGestureRecognizerDelegate这个协议，虽然实际上你并没有实现。<p></p><p>一个简单的自定义导航栏Push/Pop动画就完成了。</p><p><br /></p><h2>自定义Modal的Present/Dismiss动画</h2><div>自定义Modal的Present与Dismiss动画与之前类似，都需要提供一个动画管理器，我们用详情页面来展示一个Modal页面，详情页面就作为动画管理器：</div><div><div style="font-family: sans-serif; font-size: 16px; line-height: 110% !important; background-color: rgb(248, 248, 255) !important; border: 1px solid rgba(0, 0, 0, 0.14902) !important; padding: 8.5px !important; border-top-left-radius: 4px !important; border-top-right-radius: 4px !important; border-bottom-right-radius: 4px !important; border-bottom-left-radius: 4px !important;"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(112, 61, 170);"><span style="color: rgb(187, 44, 162);">func</span><span style="color: rgb(0, 0, 0);">&nbsp;transitionDuration(transitionContext:&nbsp;</span>UIViewControllerContextTransitioning<span style="color: rgb(0, 0, 0);">!) -&gt;&nbsp;</span>NSTimeInterval<span style="color: rgb(0, 0, 0);">&nbsp;{</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(187, 44, 162);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp;&nbsp;</span>return<span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(39, 42, 216);">0.6</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">}</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;"><br /></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;"><span style="color: rgb(187, 44, 162);">func</span>&nbsp;animateTransition(transitionContext:&nbsp;<span style="color: rgb(112, 61, 170);">UIViewControllerContextTransitioning</span>!) {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">let</span>&nbsp;containerView = transitionContext.<span style="color: rgb(61, 29, 129);">containerView</span>()</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; min-height: 11px;">&nbsp;&nbsp; &nbsp;</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">let</span>&nbsp;toViewController = transitionContext.<span style="color: rgb(61, 29, 129);">viewControllerForKey</span>(<span style="color: rgb(112, 61, 170);">UITransitionContextToViewControllerKey</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">let</span>&nbsp;fromViewController = transitionContext.<span style="color: rgb(61, 29, 129);">viewControllerForKey</span>(<span style="color: rgb(112, 61, 170);">UITransitionContextFromViewControllerKey</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; min-height: 11px;">&nbsp;&nbsp; &nbsp;</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">var</span>&nbsp;destView:&nbsp;<span style="color: rgb(112, 61, 170);">UIView</span>!</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(112, 61, 170);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(187, 44, 162);">var</span><span style="color: rgb(0, 0, 0);">&nbsp;destTransfrom =&nbsp;</span>CGAffineTransformIdentity</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">let</span>&nbsp;screenHeight =&nbsp;<span style="color: rgb(112, 61, 170);">UIScreen</span>.<span style="color: rgb(61, 29, 129);">mainScreen</span>().<span style="color: rgb(112, 61, 170);">bounds</span>.<span style="color: rgb(112, 61, 170);">size</span>.<span style="color: rgb(112, 61, 170);">height</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; min-height: 11px;">&nbsp;&nbsp; &nbsp;</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">if</span>&nbsp;modalPresentingType ==&nbsp;<span style="color: rgb(79, 129, 135);">ModalPresentingType</span>.Present {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; destView = toViewController.view</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; destView.transform = CGAffineTransformMakeTranslation(<span style="color: rgb(39, 42, 216);">0</span>, screenHeight)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; containerView.addSubview(toViewController.view)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; }&nbsp;<span style="color: rgb(187, 44, 162);">else</span>&nbsp;<span style="color: rgb(187, 44, 162);">if</span>&nbsp;modalPresentingType == ModalPresentingType.Dismiss {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; destView = fromViewController.view</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; destTransfrom = CGAffineTransformMakeTranslation(<span style="color: rgb(39, 42, 216);">0</span>, screenHeight)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; containerView.insertSubview(toViewController.view, belowSubview: fromViewController.view)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; }</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; min-height: 11px;">&nbsp;&nbsp; &nbsp;</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(112, 61, 170);">UIView</span>.<span style="color: rgb(61, 29, 129);">animateWithDuration</span>(<span style="color: rgb(49, 89, 93);">transitionDuration</span>(transitionContext), delay:&nbsp;<span style="color: rgb(39, 42, 216);">0</span>, usingSpringWithDamping:&nbsp;<span style="color: rgb(39, 42, 216);">0.6</span>, initialSpringVelocity:&nbsp;<span style="color: rgb(39, 42, 216);">0</span>,</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; options:&nbsp;<span style="color: rgb(112, 61, 170);">UIViewAnimationOptions</span>.CurveLinear, animations: {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destView.<span style="color: rgb(112, 61, 170);">transform</span>&nbsp;= destTransfrom</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; }, completion: {completed&nbsp;<span style="color: rgb(187, 44, 162);">in</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; transitionContext.<span style="color: rgb(61, 29, 129);">completeTransition</span>(<span style="color: rgb(187, 44, 162);">true</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; })</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">}</p></div></div><div>动画部分用了一个iOS7的弹簧动画，usingSpringWithDamping的值设置得越小，弹的就越明显，动画的其他地方与之前类似，不一样的是之前主页面除了做动画管理器之外，还实现了UINavigationControllerDelegate协议，因为我们是自定义导航栏的动画，而在这里需要自定义Modal动画就要实现另一个协议：<strong><span style="color:#cc0000;">UIViewControllerTransitioningDelegate</span></strong>，这个协议与之前的UINavigationControllerDelegate协议具有相似性，都是返回一个动画管理器，iOS7的方法总共有四个，有两个交互式的先不管，我们只需要实现另两个即可：</div><div><div style="font-family: sans-serif; font-size: 16px; line-height: 110% !important; background-color: rgb(248, 248, 255) !important; border: 1px solid rgba(0, 0, 0, 0.14902) !important; padding: 8.5px !important; border-top-left-radius: 4px !important; border-top-right-radius: 4px !important; border-bottom-right-radius: 4px !important; border-bottom-left-radius: 4px !important;"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;"><span style="color: rgb(187, 44, 162);">func</span>&nbsp;animationControllerForPresentedController(presented:&nbsp;<span style="color: rgb(112, 61, 170);">UIViewController</span>!, presentingController presenting:&nbsp;<span style="color: rgb(112, 61, 170);">UIViewController</span>!, sourceController source:&nbsp;<span style="color: rgb(112, 61, 170);">UIViewController</span>!) -&gt;&nbsp;<span style="color: rgb(112, 61, 170);">UIViewControllerAnimatedTransitioning</span>! {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; modalPresentingType =&nbsp;<span style="color: rgb(79, 129, 135);">ModalPresentingType</span>.Present</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(187, 44, 162);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp;&nbsp;</span>return<span style="color: rgb(0, 0, 0);">&nbsp;</span>self</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">}</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;"><br /></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;"><span style="color: rgb(187, 44, 162);">func</span>&nbsp;animationControllerForDismissedController(dismissed:&nbsp;<span style="color: rgb(112, 61, 170);">UIViewController</span>!) -&gt;&nbsp;<span style="color: rgb(112, 61, 170);">UIViewControllerAnimatedTransitioning</span>! {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; modalPresentingType =&nbsp;<span style="color: rgb(79, 129, 135);">ModalPresentingType</span>.Dismiss</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(187, 44, 162);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp;&nbsp;</span>return<span style="color: rgb(0, 0, 0);">&nbsp;</span>self</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">}</p></div></div><div>我同样的用一个属性记下是Present还是Dismiss，然后返回self。因为我是用的Storyboard，所以需要在prepareForSegue方法里设置一下transitionDelegate：</div><div><div style="font-family: sans-serif; font-size: 16px; line-height: 110% !important; background-color: rgb(248, 248, 255) !important; border: 1px solid rgba(0, 0, 0, 0.14902) !important; padding: 8.5px !important; border-top-left-radius: 4px !important; border-top-right-radius: 4px !important; border-bottom-right-radius: 4px !important; border-bottom-left-radius: 4px !important;"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;"><span style="color: rgb(187, 44, 162);">override</span>&nbsp;<span style="color: rgb(187, 44, 162);">func</span>&nbsp;prepareForSegue(segue:&nbsp;<span style="color: rgb(112, 61, 170);">UIStoryboardSegue</span>!, sender:&nbsp;<span style="color: rgb(112, 61, 170);">AnyObject</span>!) {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(112, 61, 170);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(187, 44, 162);">let</span><span style="color: rgb(0, 0, 0);">&nbsp;modal = segue.</span>destinationViewController<span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(187, 44, 162);">as</span><span style="color: rgb(0, 0, 0);">&nbsp;</span>UIViewController</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; modal.transitioningDelegate =&nbsp;<span style="color: rgb(187, 44, 162);">self</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">}</p></div></div><div>对需要执行自定义动画的VC设置transitionDelegate属性即可。</div><div>如此一来，一个针对模态VC的自定义动画也完成了。</div><div><br /></div><div><h2>自定义导航栏的交互式动画</h2><div>与动画控制器类似，我们把实现了<strong><span style="color:#cc0000;">UIViewControllerInteractiveTransitioning</span></strong>协议的对象称之为<strong><span style="color:#cc0000;">交互控制器</span></strong>，最常用的就是把交互控制器应用到导航栏的Back手势返回上，而如果要实现一个自定义的交互式动画，我们有两种方式来完成：实现一个交互控制器，或者使用iOS提供的UIPercentDrivenInteractiveTransition类作交互控制器。</div></div><br /><h3>使用UIPercentDrivenInteractiveTransition</h3><div>我们这里就用UIPercentDrivenInteractiveTransition来完成导航栏的交互式动画。先看下UIPercentDrivenInteractiveTransition的定义：</div><div><img src="https://img-blog.csdn.net/20140811144215124?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvemhhbmdhbzAwODY=/font/5a6L5L2T/fontsize/1000/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" width="746" height="370" /><br /></div><p>实际上这个类就是实现了UIViewControllerInteractiveTransitioning协议的交互控制器，我们使用它就能够轻松地为动画控制器添加一个交互动画。调用updateInteractiveTransition:更新进度；调用cancelInteractiveTransition取消交互，返回到切换前的状态；调用finishInteractiveTransition通知上下文交互已完成，同completeTransition一样。我们把交互动画应用到详情页面Back回主页面的地方，由于之前的动画管理器的角色是主页面担任的，Navigation Controller的delegate同一时间只能有一个，那在这里交互控制器的角色也由主页面来担任。首先添加一个手势识别器：</p><p></p><div style="font-family: sans-serif; font-size: 16px; line-height: 110% !important; background-color: rgb(248, 248, 255) !important; border: 1px solid rgba(0, 0, 0, 0.14902) !important; padding: 8.5px !important; border-top-left-radius: 4px !important; border-top-right-radius: 4px !important; border-bottom-right-radius: 4px !important; border-bottom-left-radius: 4px !important;"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(112, 61, 170);"><span style="color: rgb(187, 44, 162);">let</span><span style="color: rgb(0, 0, 0);">&nbsp;popRecognizer =&nbsp;</span>UIScreenEdgePanGestureRecognizer<span style="color: rgb(0, 0, 0);">(target:&nbsp;</span><span style="color: rgb(187, 44, 162);">self</span><span style="color: rgb(0, 0, 0);">, action:&nbsp;</span>Selector<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(209, 47, 27);">&quot;handlePopRecognizer:&quot;</span><span style="color: rgb(0, 0, 0);">))</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">popRecognizer.<span style="color: rgb(112, 61, 170);">edges</span>&nbsp;=&nbsp;<span style="color: rgb(112, 61, 170);">UIRectEdge</span>.Left</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(112, 61, 170);"><span style="color: rgb(187, 44, 162);">self</span><span style="color: rgb(0, 0, 0);">.</span>navigationController<span style="color: rgb(0, 0, 0);">.</span>view<span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(61, 29, 129);">addGestureRecognizer</span><span style="color: rgb(0, 0, 0);">(popRecognizer)</span></p></div><p></p>UIScreenEdgePanGestureRecognizer继承于UIPanGestureRecognizer，能检测从屏幕边缘滑动的手势，设置edges为left检测左边即可。然后实现handlePopRecognizer:<p></p><div style="font-family: sans-serif; font-size: 16px; line-height: 110% !important; background-color: rgb(248, 248, 255) !important; border: 1px solid rgba(0, 0, 0, 0.14902) !important; padding: 8.5px !important; border-top-left-radius: 4px !important; border-top-right-radius: 4px !important; border-bottom-right-radius: 4px !important; border-bottom-left-radius: 4px !important;"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;"><span style="color: rgb(187, 44, 162);">func</span>&nbsp;handlePopRecognizer(popRecognizer:&nbsp;<span style="color: rgb(112, 61, 170);">UIScreenEdgePanGestureRecognizer</span>) {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(112, 61, 170);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(187, 44, 162);">var</span><span style="color: rgb(0, 0, 0);">&nbsp;progress = popRecognizer.</span><span style="color: rgb(61, 29, 129);">translationInView</span><span style="color: rgb(0, 0, 0);">(</span>navigationController<span style="color: rgb(0, 0, 0);">.</span>view<span style="color: rgb(0, 0, 0);">).</span>x<span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(61, 29, 129);">/</span><span style="color: rgb(0, 0, 0);">&nbsp;</span>navigationController<span style="color: rgb(0, 0, 0);">.</span>view<span style="color: rgb(0, 0, 0);">.</span>bounds<span style="color: rgb(0, 0, 0);">.</span>size<span style="color: rgb(0, 0, 0);">.</span>width</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; progress =&nbsp;<span style="color: rgb(61, 29, 129);">min</span>(<span style="color: rgb(39, 42, 216);">1.0</span>,&nbsp;<span style="color: rgb(61, 29, 129);">max</span>(<span style="color: rgb(39, 42, 216);">0.0</span>, progress))</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; min-height: 11px;">&nbsp;&nbsp; &nbsp;</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(61, 29, 129);">println</span>(<span style="color: rgb(209, 47, 27);">&quot;</span>\(progress)<span style="color: rgb(209, 47, 27);">&quot;</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(112, 61, 170);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(187, 44, 162);">if</span><span style="color: rgb(0, 0, 0);">&nbsp;popRecognizer.</span>state<span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(61, 29, 129);">==</span><span style="color: rgb(0, 0, 0);">&nbsp;</span>UIGestureRecognizerState<span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(61, 29, 129);">Began</span><span style="color: rgb(0, 0, 0);">&nbsp;{</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(61, 29, 129);">println</span>(<span style="color: rgb(209, 47, 27);">&quot;Began&quot;</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(112, 61, 170);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(187, 44, 162);">self</span><span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(79, 129, 135);">interactivePopTransition</span><span style="color: rgb(0, 0, 0);">&nbsp;=&nbsp;</span>UIPercentDrivenInteractiveTransition<span style="color: rgb(0, 0, 0);">()</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(61, 29, 129);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(187, 44, 162);">self</span><span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(112, 61, 170);">navigationController</span><span style="color: rgb(0, 0, 0);">.</span>popViewControllerAnimated<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(187, 44, 162);">true</span><span style="color: rgb(0, 0, 0);">)</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(112, 61, 170);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; }&nbsp;</span><span style="color: rgb(187, 44, 162);">else</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(187, 44, 162);">if</span><span style="color: rgb(0, 0, 0);">&nbsp;popRecognizer.</span>state<span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(61, 29, 129);">==</span><span style="color: rgb(0, 0, 0);">&nbsp;</span>UIGestureRecognizerState<span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(61, 29, 129);">Changed</span><span style="color: rgb(0, 0, 0);">&nbsp;{</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(61, 29, 129);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(187, 44, 162);">self</span><span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(79, 129, 135);">interactivePopTransition</span><span style="color: rgb(0, 0, 0);">?.</span>updateInteractiveTransition<span style="color: rgb(0, 0, 0);">(progress)</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(61, 29, 129);">println</span>(<span style="color: rgb(209, 47, 27);">&quot;Changed&quot;</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(112, 61, 170);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; }&nbsp;</span><span style="color: rgb(187, 44, 162);">else</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(187, 44, 162);">if</span><span style="color: rgb(0, 0, 0);">&nbsp;popRecognizer.</span>state<span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(61, 29, 129);">==</span><span style="color: rgb(0, 0, 0);">&nbsp;</span>UIGestureRecognizerState<span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(61, 29, 129);">Ended</span><span style="color: rgb(0, 0, 0);">&nbsp;|| popRecognizer.</span>state<span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(61, 29, 129);">==</span><span style="color: rgb(0, 0, 0);">&nbsp;</span>UIGestureRecognizerState<span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(61, 29, 129);">Cancelled</span><span style="color: rgb(0, 0, 0);">&nbsp;{</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">if</span>&nbsp;progress &gt;&nbsp;<span style="color: rgb(39, 42, 216);">0.5</span>&nbsp;{</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(61, 29, 129);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(187, 44, 162);">self</span><span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(79, 129, 135);">interactivePopTransition</span><span style="color: rgb(0, 0, 0);">?.</span>finishInteractiveTransition<span style="color: rgb(0, 0, 0);">()</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; }&nbsp;<span style="color: rgb(187, 44, 162);">else</span>&nbsp;{</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(61, 29, 129);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(187, 44, 162);">self</span><span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(79, 129, 135);">interactivePopTransition</span><span style="color: rgb(0, 0, 0);">?.</span>cancelInteractiveTransition<span style="color: rgb(0, 0, 0);">()</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; }</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(209, 47, 27);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(61, 29, 129);">println</span><span style="color: rgb(0, 0, 0);">(</span>&quot;Ended || Cancelled&quot;<span style="color: rgb(0, 0, 0);">)</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(79, 129, 135);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(187, 44, 162);">self</span><span style="color: rgb(0, 0, 0);">.</span>interactivePopTransition<span style="color: rgb(0, 0, 0);">&nbsp;=&nbsp;</span><span style="color: rgb(187, 44, 162);">nil</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; }</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">}</p></div><p></p>我用了一个实例变量引用UIPercentDrivenInteractiveTransition，这个类只在需要用时才创建，否则在正常Push/Pop的时候，即使只是点击操作并没有识别手势的情况下，也会进入交互（你也可以在要求你返回交互控制器时，进行一些判断，通过返回nil来屏蔽，但这显然就太麻烦了）。当手势识别的时候我们调用pop，用户手势发生变化时，调用update去更新，不管是end还是cancel，都判断下是进入下一个页面还是返回之前的页面，完成这一切后把交互控制器清理掉。<p></p><p>现在我们已经有了交互控制器对象，只需要把它给告知给Navigation Controller就行了，我们实现UINavigationControllerDelegate的另一个方法：</p><p></p><div style="font-family: sans-serif; font-size: 16px; line-height: 110% !important; background-color: rgb(248, 248, 255) !important; border: 1px solid rgba(0, 0, 0, 0.14902) !important; padding: 8.5px !important; border-top-left-radius: 4px !important; border-top-right-radius: 4px !important; border-bottom-right-radius: 4px !important; border-bottom-left-radius: 4px !important;"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;"><span style="color: rgb(187, 44, 162);">func</span>&nbsp;navigationController(navigationController:&nbsp;<span style="color: rgb(112, 61, 170);">UINavigationController</span>!, interactionControllerForAnimationController animationController:&nbsp;<span style="color: rgb(112, 61, 170);">UIViewControllerAnimatedTransitioning</span>!) -&gt;&nbsp;<span style="color: rgb(112, 61, 170);">UIViewControllerInteractiveTransitioning</span>! {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(79, 129, 135);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(187, 44, 162);">return</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(187, 44, 162);">self</span><span style="color: rgb(0, 0, 0);">.</span>interactivePopTransition</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">}</p></div><p></p><p>我们从详情页面通过自定义的交互动画返回到上一个页面的工作就完成了。</p><p>Demo效果预览：</p><p><img src="https://img-blog.csdn.net/20140812122023081" alt="" /><br /></p><p></p><p><span style="font-size:18px;"><a target=_blank target="_blank" href="http://download.csdn.net/download/zhangao0086/7740937">使用UIPercentDrivenInteractiveTransition的Demo</a></span></p><br /><h3>自定义交互控制器</h3><div>我在之前提过，UIPercentDrivenInteractiveTransition实际上就是实现了<strong>UIViewControllerInteractiveTransitioning</strong>协议，只要是实现了这个协议的对象就可以称之为交互控制器，我们如果想更加精确的管理动画以及深入理解处理上的细节，就需要自己实现<strong>UIViewControllerInteractiveTransitioning</strong>协议。</div><div>UIViewControllerInteractiveTransitioning协议总共有三个方法，其中startInteractiveTransition:是必须实现的方法，我们在里面初始化动画的状态：</div><div><div style="font-family: sans-serif; font-size: 16px; line-height: 110% !important; background-color: rgb(248, 248, 255) !important; border: 1px solid rgba(0, 0, 0, 0.14902) !important; padding: 8.5px !important; border-top-left-radius: 4px !important; border-top-right-radius: 4px !important; border-bottom-right-radius: 4px !important; border-bottom-left-radius: 4px !important;"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;"><span style="color: rgb(187, 44, 162);">func</span>&nbsp;startInteractiveTransition(transitionContext:&nbsp;<span style="color: rgb(112, 61, 170);">UIViewControllerContextTransitioning</span>!) {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">self</span>.transitionContext = transitionContext</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; min-height: 11px;">&nbsp;&nbsp; &nbsp;</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">let</span>&nbsp;containerView = transitionContext.<span style="color: rgb(61, 29, 129);">containerView</span>()</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">let</span>&nbsp;toViewController = transitionContext.<span style="color: rgb(61, 29, 129);">viewControllerForKey</span>(<span style="color: rgb(112, 61, 170);">UITransitionContextToViewControllerKey</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">let</span>&nbsp;fromViewController = transitionContext.<span style="color: rgb(61, 29, 129);">viewControllerForKey</span>(<span style="color: rgb(112, 61, 170);">UITransitionContextFromViewControllerKey</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; min-height: 11px;">&nbsp;&nbsp; &nbsp;</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; containerView.<span style="color: rgb(61, 29, 129);">insertSubview</span>(toViewController.<span style="color: rgb(112, 61, 170);">view</span>, belowSubview: fromViewController.<span style="color: rgb(112, 61, 170);">view</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; min-height: 11px;">&nbsp;&nbsp; &nbsp;</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">self</span>.transitingView = fromViewController.view</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">}</p></div></div><div>这里不涉及动画，只是把需要切换的view添加到上下文环境中即可。动画部分我们还是和之前使用UIPercentDrivenInteractiveTransition的接口保持一致，添加几个方法：</div><div><div style="font-family: sans-serif; font-size: 16px; line-height: 110% !important; background-color: rgb(248, 248, 255) !important; border: 1px solid rgba(0, 0, 0, 0.14902) !important; padding: 8.5px !important; border-top-left-radius: 4px !important; border-top-right-radius: 4px !important; border-bottom-right-radius: 4px !important; border-bottom-left-radius: 4px !important;"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;"><span style="color: rgb(187, 44, 162);">func</span>&nbsp;updateWithPercent(percent:&nbsp;<span style="color: rgb(112, 61, 170);">CGFloat</span>) {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">let</span>&nbsp;scale =&nbsp;<span style="color: rgb(112, 61, 170);">CGFloat</span>(<span style="color: rgb(61, 29, 129);">fabsf</span>(<span style="color: rgb(112, 61, 170);">Float</span>(percent&nbsp;<span style="color: rgb(61, 29, 129);">-</span>&nbsp;<span style="color: rgb(112, 61, 170);">CGFloat</span>(<span style="color: rgb(39, 42, 216);">1.0</span>))))</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; transitingView?.transform =&nbsp;<span style="color: rgb(61, 29, 129);">CGAffineTransformMakeScale</span>(scale, scale)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; transitionContext?.updateInteractiveTransition(percent)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">}</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; min-height: 11px;"><br /></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;"><span style="color: rgb(187, 44, 162);">func</span>&nbsp;finishBy(cancelled:&nbsp;<span style="color: rgb(112, 61, 170);">Bool</span>) {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">if</span>&nbsp;cancelled {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(112, 61, 170);">UIView</span>.animateWithDuration(<span style="color: rgb(39, 42, 216);">0.4</span>, animations: {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">self</span>.transitingView!.transform =&nbsp;<span style="color: rgb(112, 61, 170);">CGAffineTransformIdentity</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }, completion: {completed&nbsp;<span style="color: rgb(187, 44, 162);">in</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">self</span>.transitionContext!.cancelInteractiveTransition()</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">self</span>.transitionContext!.completeTransition(<span style="color: rgb(187, 44, 162);">false</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; })</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; }&nbsp;<span style="color: rgb(187, 44, 162);">else</span>&nbsp;{</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(112, 61, 170);">UIView</span>.<span style="color: rgb(61, 29, 129);">animateWithDuration</span>(<span style="color: rgb(39, 42, 216);">0.4</span>, animations: {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(<span style="color: rgb(187, 44, 162);">self</span>.transitingView)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">self</span>.transitingView!.transform =&nbsp;<span style="color: rgb(61, 29, 129);">CGAffineTransformMakeScale</span>(<span style="color: rgb(39, 42, 216);">0</span>,&nbsp;<span style="color: rgb(39, 42, 216);">0</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(<span style="color: rgb(187, 44, 162);">self</span>.transitingView)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }, completion: {completed&nbsp;<span style="color: rgb(187, 44, 162);">in</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">self</span>.transitionContext!.finishInteractiveTransition()</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">self</span>.transitionContext!.completeTransition(<span style="color: rgb(187, 44, 162);">true</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; })</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; }</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">}</p></div></div><div>updateWithPercent:方法用来更新view的transform属性，finishBy:方法主要用来判断是进入下一个页面还是返回到之前的页面，并告知transitionContext目前的状态，以及对当前正在scale的view做最后的动画。这里的transitionContext和transitingView可以在前面的处理手势识别代码中取得，我将里面的代码更新了一下，变成下面这样：</div><div><div style="font-family: sans-serif; font-size: 16px; line-height: 110% !important; background-color: rgb(248, 248, 255) !important; border: 1px solid rgba(0, 0, 0, 0.14902) !important; padding: 8.5px !important; border-top-left-radius: 4px !important; border-top-right-radius: 4px !important; border-bottom-right-radius: 4px !important; border-bottom-left-radius: 4px !important;"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;"><span style="color: rgb(187, 44, 162);">func</span>&nbsp;handlePopRecognizer(popRecognizer:&nbsp;<span style="color: rgb(112, 61, 170);">UIScreenEdgePanGestureRecognizer</span>) {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(112, 61, 170);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(187, 44, 162);">var</span><span style="color: rgb(0, 0, 0);">&nbsp;progress = popRecognizer.</span><span style="color: rgb(61, 29, 129);">translationInView</span><span style="color: rgb(0, 0, 0);">(</span>navigationController<span style="color: rgb(0, 0, 0);">.</span>view<span style="color: rgb(0, 0, 0);">).</span>x<span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(61, 29, 129);">/</span><span style="color: rgb(0, 0, 0);">&nbsp;</span>navigationController<span style="color: rgb(0, 0, 0);">.</span>view<span style="color: rgb(0, 0, 0);">.</span>bounds<span style="color: rgb(0, 0, 0);">.</span>size<span style="color: rgb(0, 0, 0);">.</span>width</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; progress =&nbsp;<span style="color: rgb(61, 29, 129);">min</span>(<span style="color: rgb(39, 42, 216);">1.0</span>,&nbsp;<span style="color: rgb(61, 29, 129);">max</span>(<span style="color: rgb(39, 42, 216);">0.0</span>, progress))</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; min-height: 11px;">&nbsp;&nbsp; &nbsp;</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(61, 29, 129);">println</span>(<span style="color: rgb(209, 47, 27);">&quot;</span>\(progress)<span style="color: rgb(209, 47, 27);">&quot;</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(112, 61, 170);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp;&nbsp;</span><span style="color: rgb(187, 44, 162);">if</span><span style="color: rgb(0, 0, 0);">&nbsp;popRecognizer.</span>state<span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(61, 29, 129);">==</span><span style="color: rgb(0, 0, 0);">&nbsp;</span>UIGestureRecognizerState<span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(61, 29, 129);">Began</span><span style="color: rgb(0, 0, 0);">&nbsp;{</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(61, 29, 129);">println</span>(<span style="color: rgb(209, 47, 27);">&quot;Began&quot;</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; isTransiting =&nbsp;<span style="color: rgb(187, 44, 162);">true</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(0, 132, 0);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>//self.interactivePopTransition = UIPercentDrivenInteractiveTransition()</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(61, 29, 129);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(187, 44, 162);">self</span><span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(112, 61, 170);">navigationController</span><span style="color: rgb(0, 0, 0);">.</span>popViewControllerAnimated<span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(187, 44, 162);">true</span><span style="color: rgb(0, 0, 0);">)</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(112, 61, 170);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; }&nbsp;</span><span style="color: rgb(187, 44, 162);">else</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(187, 44, 162);">if</span><span style="color: rgb(0, 0, 0);">&nbsp;popRecognizer.</span>state<span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(61, 29, 129);">==</span><span style="color: rgb(0, 0, 0);">&nbsp;</span>UIGestureRecognizerState<span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(61, 29, 129);">Changed</span><span style="color: rgb(0, 0, 0);">&nbsp;{</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(0, 132, 0);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>//self.interactivePopTransition?.updateInteractiveTransition(progress)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; updateWithPercent(progress)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(61, 29, 129);">println</span>(<span style="color: rgb(209, 47, 27);">&quot;Changed&quot;</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(112, 61, 170);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; }&nbsp;</span><span style="color: rgb(187, 44, 162);">else</span><span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(187, 44, 162);">if</span><span style="color: rgb(0, 0, 0);">&nbsp;popRecognizer.</span>state<span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(61, 29, 129);">==</span><span style="color: rgb(0, 0, 0);">&nbsp;</span>UIGestureRecognizerState<span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(61, 29, 129);">Ended</span><span style="color: rgb(0, 0, 0);">&nbsp;|| popRecognizer.</span>state<span style="color: rgb(0, 0, 0);">&nbsp;</span><span style="color: rgb(61, 29, 129);">==</span><span style="color: rgb(0, 0, 0);">&nbsp;</span>UIGestureRecognizerState<span style="color: rgb(0, 0, 0);">.</span><span style="color: rgb(61, 29, 129);">Cancelled</span><span style="color: rgb(0, 0, 0);">&nbsp;{</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(0, 132, 0);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>//if progress &gt; 0.5 {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(0, 132, 0);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>//&nbsp; &nbsp; self.interactivePopTransition?.finishInteractiveTransition()</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(0, 132, 0);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>//} else {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(0, 132, 0);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>//&nbsp; &nbsp; self.interactivePopTransition?.cancelInteractiveTransition()</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(0, 132, 0);">//}</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; finishBy(progress &lt;&nbsp;<span style="color: rgb(39, 42, 216);">0.5</span>)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(209, 47, 27);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: rgb(61, 29, 129);">println</span><span style="color: rgb(0, 0, 0);">(</span>&quot;Ended || Cancelled&quot;<span style="color: rgb(0, 0, 0);">)</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp; isTransiting =&nbsp;<span style="color: rgb(187, 44, 162);">false</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(0, 132, 0);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>//self.interactivePopTransition = nil</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; }</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">}</p></div></div><div>另外还用一个额外布尔值变量isTransiting来标识当前是否在手势识别中，这是为了在返回交互控制器的时候，不会在不当的时候返回self：</div><div><div style="font-family: sans-serif; font-size: 16px; line-height: 110% !important; background-color: rgb(248, 248, 255) !important; border: 1px solid rgba(0, 0, 0, 0.14902) !important; padding: 8.5px !important; border-top-left-radius: 4px !important; border-top-right-radius: 4px !important; border-bottom-right-radius: 4px !important; border-bottom-left-radius: 4px !important;"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;"><span style="color: rgb(187, 44, 162);">func</span>&nbsp;navigationController(navigationController:&nbsp;<span style="color: rgb(112, 61, 170);">UINavigationController</span>!, interactionControllerForAnimationController animationController:</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(112, 61, 170);">UIViewControllerAnimatedTransitioning<span style="color: rgb(0, 0, 0);">!) -&gt;&nbsp;</span>UIViewControllerInteractiveTransitioning<span style="color: rgb(0, 0, 0);">! {</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">if</span>&nbsp;!<span style="color: rgb(187, 44, 162);">self</span>.isTransiting {</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: rgb(187, 44, 162);">return</span>&nbsp;<span style="color: rgb(187, 44, 162);">nil</span></p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">&nbsp; &nbsp; }</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(187, 44, 162);"><span style="color: rgb(0, 0, 0);">&nbsp; &nbsp;&nbsp;</span>return<span style="color: rgb(0, 0, 0);">&nbsp;</span>self</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;">}</p></div></div><div>这样一来就完成了自定义交互控制器。可以发现，基本流程与使用UIPercentDrivenInteractiveTransition是一致的，UIPercentDrivenInteractiveTransition主要是帮我们封装了transitionContext的初始化以及对它的调用等，只是动画部分需要我们在额外处理一下了。</div><div><span style="font-size:18px;"><a target=_blank target="_blank" href="http://download.csdn.net/download/zhangao0086/7741237">使用自定义交互控制器的Demo</a></span></div><div><br /></div><h2><span style="color:#cc0000;">最终效果:</span></h2><div>我在主页面上多放了几个带Image的Button，在点击Button时会将Button的Image传递到详情页面，详情页面相应的也有一个UIImageView用来显示。在主页面初始化动画状态的时候，会生成一个Image的快照来进行动画，要是在以前，我们只能通过UIGraphics的APIs进行一系列的操作，涉及视图的scale、旋转、透明及渲染到context等，但现在，我们只需要用iOS7的API就行了：</div><div><div style="font-family: sans-serif; font-size: 16px; line-height: 110% !important; background-color: rgb(248, 248, 255) !important; border: 1px solid rgba(0, 0, 0, 0.14902) !important; padding: 8.5px !important; border-top-left-radius: 4px !important; border-top-right-radius: 4px !important; border-bottom-right-radius: 4px !important; border-bottom-left-radius: 4px !important;"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo; color: rgb(187, 44, 162);">@availability(iOS, introduced=7.0)</p><p style="margin-top: 0px; margin-bottom: 0px; font-size: 12px; font-family: Menlo;"><span style="color: rgb(187, 44, 162);">func</span>&nbsp;snapshotViewAfterScreenUpdates(afterUpdates:&nbsp;<span style="color: rgb(112, 61, 170);">Bool</span>) -&gt;&nbsp;<span style="color: rgb(112, 61, 170);">UIView</span></p></div></div><div>这个API能帮助我们快速获取一个视图的的快照，afterUpdates参数表示是否等所有效果应用到该视图之后再获取，如果设置为false，则立即获取；为true则会受到后面对该视图的影响。</div><div>在动画之前，把主页面和详情页面对应的Button和ImageView隐藏，然后对快照生成的View进行动画，动画用简单的frame隐式动画就可以了。<br /><br /></div><div><span style="font-size: 18px;"><a target=_blank target="_blank" href="https://github.com/zhangao0086/iOS_AnimatedTransition">最终效果的Demo</a></span><span style="font-size: 10px;">(上传到我的资源页面时总是失败，所以只能上传到GitHub上了)</span></div><div><a target=_blank target="_blank" href="https://github.com/zhangao0086/iOS_AnimatedTransition"></a><span style="font-size:10px;"><br /></span>最后附上一张图，这个图比较容易区分那几个名称相近的协议：</div><div><img src="https://img-blog.csdn.net/20140811191307593" alt="" width="746" height="300" /><br /><br /><br /></div><h2><span style="color:#cc0000;">UPDATED:</span></h2><div>GitHub上已更新至Xcode 6，主要是语法上的一些小调整</div><div><br /></div>