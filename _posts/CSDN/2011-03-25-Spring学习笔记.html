---
layout: post
title: "Spring学习笔记"
date: 2011-03-25 16:48:00
categories: [Java]
---


<p>Spring的作用:</p><ul><li>能够降低组件之间的耦合度,实现软件之间的解耦 </li><li>可以使用Spring容器的众多服务,比如:事务管理器.当我们使用事务管理器时,开发人员不需要手动控制事务,也不需要处理复杂的事务传播. </li><li>Spring容器提供单例模式的支持 </li><li>容器提供了AOP技术,利用它很容易实现如权限拦截、运行期监控等. </li><li>容器提供了很多辅助器,这些类能够加快应用的开发,如:JdbcTemplate、HibernateTemplate等. </li><li>Spring提供了主流应用框架的支持,如:集成Hibernate、JPA、Struts等,便于应用程序的开发 </li></ul><p>Spring的核心技术是IoC(Inversion of Control)和AOP(Aspect-oriented programming).</p><p>IoC还有另一个名字,叫DI(Dependency Injection),称为&quot;依赖注入&quot;.所谓依赖注入就是指,在运行期间,由外部容器动态地将依赖对象注入到组件中.</p><p>依赖注入有三种方式:</p><ol><li>使用构造器注入 </li><li>使用属性setter注入 </li><li>使用Field注入(利用注解) </li></ol><p><span style="font-size: 24px; "><strong>Bean的装配 </strong></span></p><p>Spring提供三种实例化Bean的方式:</p><p>使用类构造器的方式</p><blockquote><p>&lt;bean id=”唯一标识符” class=”完整类名”&gt;&lt;/bean&gt;</p></blockquote><p>使用静态工厂的方式</p><blockquote><p>&lt;bean id=&quot;唯一标识符&quot; </p><p>class=&quot;工厂的完整类名&quot; factory-method=&quot;需要执行工厂的哪个方法的方法名&quot; /&gt; </p></blockquote><p>使用工厂实例的方式</p><blockquote><p>&lt;bean id=“唯一标识符1&quot; class=&quot;工厂的完整类名&quot;/&gt; </p><p>&lt;bean id=&quot;唯一标识符2&quot; factory-bean=“唯一标识符1&quot; </p><p>factory-method=&quot;需要执行工厂的哪个方法的方法名&quot; /&gt;</p></blockquote><p>Bean在实例化的时候默认只有一个,不管获得几次,都是同一个Bean,不过Spring提供了修改Bean作用域的属性,有几种取值: </p><p>singleton,prototype,request,session,global session.有几个都没什么用. </p><p>除了配置的注入方式以外,还可以使用注解的方式进行注入,在JAVA代码中使用@Autowired或@Resource注解方式进行装配.不过在装配之前,需要引入context命名空间,虽然Spring支持注解的解析,但是默认解析的&quot;开关&quot;没有打开,必须在配置文件里添加&lt;context:annotation-config /&gt;标签,这个标签隐式的注册了Spring对注解进行解析的处理器: </p><p>AutowiredAnnotationBeanPostProcessor，CommonAnnotationBeanPostProcessor， </p><p>PersistenceAnnotationBeanPostProcessor，RequiredAnnotationBeanPostProcessor </p><p>@Autowired可以作用在构造器、字段和方法上,默认以类型进行查找,默认情况下它要求的依赖对象必须存在,如果可以允许不存在,则需要设置它的required属性值为false.如果想以名称进行查找,可以结合@Qualifier注解一起使用,如@Autowired @Qualifier(&quot;指定名称&quot;).@Qualifier注解还可以指定在构造器或者方法的参数在,如: </p><blockquote><p>@Autowired <br />public void setPersonDao(@Qualifier(&quot;personDao&quot;) PersonDao personDao) {//用于属性的set方法上 <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; this.personDao = personDao; <br />} </p></blockquote><p>@Resource可以作用在类、方法和字段上,默认以名称进行查找,如果找不到相应的Bean,则以类型进行查找.如果指定了name属性,则只按名称进行查找.</p><p>另外,Spring还支持Bean的自动装配:</p><p><span style="white-space: pre">	</span>&lt;bean id=“foo” class=“...Foo”&nbsp; autowire=“autowire type”&gt;</p><p>autowire的取值包含(byType,byName,constructor,autodetecte),只用了解就行了,不常用,以免出现不可预知的后果.</p><p>此外,项目中通常会有上百个组件,如果这些组件全部采用在配置文件中通过Bean的方式来配置,则会明显增加配置文件的体积,查找和维护起来也会相关不便.所以,Spring2.5提供了自动扫描组件的方式来配置组件,它通过在类路径下寻找标了@Component、@Service、@Controller和@Repository注解的类,并把这些类纳入到Spring的容器中进行管理.</p><p>要使用自动扫描机制,需要引入context命名空间,并且需要在配置文件里面加上:</p><p>&lt;context:component-scan base-package=&quot;包名&quot;/&gt;.</p><p>这个标签将扫描指定包(含子包)下的所有组件.并且把AutowiredAnnotationBeanPostProcessor 和CommonAnnotationBeanPostProcessor隐式地被包括进来以进行注解解析.</p><p><span style="font-size: 24px; "><strong>AOP--面向切面编程</strong></span></p><h3>AOP代理对象</h3><p>如果目标对象实现了接口,则代理对象也实现同样的接口,否则使用cglib代理,则Spring有两种代理方式:</p><ol><li>若目标对象实现了若干接口，spring使用JDK的java.lang.reflect.Proxy类代理。 </li><li>若目标对象没有实现任何接口，spring使用CGLIB库生成目标对象的子类。 </li></ol><p>备注:&nbsp;</p><p><span style="white-space: pre;">	</span>对接口创建代理优于对类创建代理,因为这将产生更加松耦合的系统.</p><p><span style="white-space: pre;">	</span>标记为final的方法无法得到通知,Spring需要为目标类产生子类,需要覆写被通知的方法,然后将通知织入.final方法不允许被覆写.</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>AOP中有几个概念,这些概念我们经常会用到,大数人也经常在程序中写出来,但是自己不知道:</p><h4>Jointpoint(连接点)</h4><p>连接点就是被拦截到的那个点,在Spring中,&quot;点&quot;指的是方法,因为Spring只支持方法类型的连接点.也就是说,哪个方法现在被拦截到了,我们就把这个方法称为连接点.</p><h4>Pointcut(切入点)</h4><p>切入点就是我们要拦截哪些连接点.比如你的工作是查水表,你负责的那个区域就是切入点,你现在正在查的那家,就是连接点.</p><h4>Advice(通知)</h4><p>通知就是拦截到连接点之后要做的事情,比如乘地铁,你不带包就不用安检,如果你带了包,就要安检(被拦截到了),然后X射线检查你的包就是一个通知.通知分为:前置通知,后置通知,最终通知,异常通知,环绕通知五种.</p><h4>Aspect(切面)</h4><p>是通知和切入点的结合,通知和切入点共同定义了关于切面的全部内容---它的功能、在何时和何地完成其功能,简单的说,通知所在的类,并且定义了切入点,那么这个类就是切面.</p><h4>Target(目标对象)</h4><p>需要代理的对象.</p><h4>Weaving(织入)</h4><p>把切面应用到目标对象来创建一个代理对象的过程就叫织入.</p><h4>Introduction(引入)</h4><p>引入就是在不修改类代码的前提下, Introduction可以在运行期为类动态地添加一些方法或Field.</p><p>&nbsp;</p><p>&nbsp;</p><hr /><p>要进行AOP编程,首先就要引入aop命名空间,Spring提供了两种切面方式,实际工作中我们可以任选其一:</p><ul><li>基于XML配置方式进行AOP开发 </li><li>基于注解方式进行AOP开发 </li></ul><p>切面类:</p><div id="codeSnippetWrapper" style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; width: 99%; font-family: 'Courier New', courier, monospace; direction: ltr; font-size: 10pt; overflow: auto; cursor: text; border: silver 1px solid; padding: 4px;"><div id="codeSnippet" style="text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> Security {     <span style="color: #008000">//切面</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">   <span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> checkSecurity(JoinPoint joinPoint){  <span style="color: #008000">//通知</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">           System.out.println(<span style="color: #006080">&quot;进行安全检查 &quot;</span>);</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">   }</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">} </pre><!--CRLF--></div></div><p>如果使用XML配置方式,需要在文件中使用&lt;aop:config&gt;标签,如:</p><div id="codeSnippetWrapper" style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; width: 99%; font-family: 'Courier New', courier, monospace; direction: ltr; font-size: 10pt; overflow: auto; cursor: text; border: silver 1px solid; padding: 4px;"><div id="codeSnippet" style="text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">&lt;bean id=<span style="color: #006080">&quot;security&quot;</span> <span style="color: #0000ff">class</span>=<span style="color: #006080">&quot;切面类&quot;</span> /&gt;&lt;!-- 定义切面对象 --&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">&lt;bean id=<span style="color: #006080">&quot;userManager&quot;</span> <span style="color: #0000ff">class</span>=<span style="color: #006080">&quot;目标对象类&quot;</span> /&gt;&lt;!--创建接口实现类对象--&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    &lt;aop:config&gt;  &lt;!--所有的切面和通知都必须定义在aop:config元素内部 --&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">      &lt;aop:aspect ref=<span style="color: #006080">&quot;security&quot;</span>&gt;  &lt;!-- 声明切面  --&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">         &lt;!-- 声明切入点 --&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">         &lt;aop:pointcut id=<span style="color: #006080">&quot;userManagerPointcut&quot;</span> </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">               expression=<span style="color: #006080">&quot;execution(* *.*(..))&quot;</span>/&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">         &lt;!--声明后置通知,在匹配的方法完全执行后运行--&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">         &lt;aop:after-returning method=<span style="color: #006080">&quot;checkSecurity&quot;</span> pointcut-ref=<span style="color: #006080">&quot;userManagerPointcut&quot;</span>/&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">       &lt;/aop:aspect&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    &lt;/aop:config&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"> </pre><!--CRLF--></div></div><p>&nbsp;</p><p>如果想在通知中获取相关数据,任何通知方法可以将第一个参数定义为<code class="interfacename">org.aspectj.lang.JoinPoint</code>类型 （环绕通知需要定义第一个参数为<code class="interfacename">ProceedingJoinPoint</code>类型， 它是 <code class="interfacename">JoinPoint</code> 的一个子类）。<code class="interfacename">JoinPoint</code> 接口提供了一系列有用的方法，比如 <code class="literal">getArgs()</code>（返回方法参数）、 <code class="literal">getThis()</code>（返回代理对象）、<code class="literal">getTarget()</code>（返回目标）、 <code class="literal">getSignature()</code>（返回正在被通知的方法签名）和 <code class="literal">toString()</code> （打印出正在被通知的方法的有用信息）。</p><p>基于注解的方式除了在配置文件中引入aop的命名空间以外,还需要打开自动代理:</p><p>&lt;aop:aspectj-autoproxy/&gt;</p><p>这个标签将启用Spring对@AspectJ的支持,配置文件里面只需要声明切面对象和目标对象就行了,在类上标注@Aspect注解用以声明切面,然后在切面的方法上面标注通知或者切入点.</p><p>&nbsp;</p><p>&nbsp;&nbsp; 定义切入点的几点注意:</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * 切入点使用方法定义的形式出现</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * 方法的定义</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * 方法的修饰符private修饰</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * 方法的返回值类型是void</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * 方法的名称自定义</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * 方法没有参数</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * 方法有方法体,方法体为空</p><p>在方法上使用@Pointcut定义切入点,如:</p><div id="codeSnippetWrapper" style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; width: 99%; font-family: 'Courier New', courier, monospace; direction: ltr; font-size: 10pt; overflow: auto; cursor: text; border: silver 1px solid; padding: 4px;"><div id="codeSnippet" style="text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">@Pointcut(<span style="color: #006080">&quot;execution( * cn.itcast.aop.aspectJ.before.UserManagerImpl.save*(..))&quot;</span>)</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #0000ff">private</span> <span style="color: #0000ff">void</span>  perform(){}</pre><!--CRLF--></div></div><p>切入点表达式写法:</p><p> *&nbsp;&nbsp;&nbsp; 切入点表达式的写法</p><p> *&nbsp;&nbsp;&nbsp; execution(主要)表示匹配方法执行的连接点 </p><p> *&nbsp;&nbsp;&nbsp; 例如: * com.itcast.service..*.save*(..))</p><p> *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 &quot;*&quot;&nbsp; 表示方法的返回类型任意</p><p> *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 com.itcast.service..*&nbsp; 表示service包及其子包中所有的类</p><p> *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 .save* 表示类中所有以save开头的方法</p><p> *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 (..) 表示参数是任意数量</p><p>&nbsp;</p><p>定义通知:</p><div id="codeSnippetWrapper" style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; width: 99%; font-family: 'Courier New', courier, monospace; direction: ltr; font-size: 10pt; overflow: auto; cursor: text; border: silver 1px solid; padding: 4px;"><div id="codeSnippet" style="text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #008000">/**</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #008000"> * @Before表示前置通知</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #008000"> *   等价于</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #008000"> *   aop:before method=&quot;checkSecurity&quot; pointcut-ref=&quot;perform&quot; </span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #008000"> * @param joinPoint</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #008000"> */</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">@Before(<span style="color: #006080">&quot;perform()||perform1()&quot;</span>)            <span style="color: #008000">//可以使用多个切入点,用||隔开</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> checkSecurity(JoinPoint  joinPoint){</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">   System.out.println(<span style="color: #006080">&quot;进行安全性检查&quot;</span>);</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">   <span style="color: #0000ff">if</span>(joinPoint.getArgs()!=null&amp;&amp;joinPoint.getArgs().length&gt;0){</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">       <span style="color: #0000ff">for</span>(<span style="color: #0000ff">int</span> i=0;i&lt;joinPoint.getArgs().length;i++){</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">            System.out.println(<span style="color: #006080">&quot;方法的参数  &quot;</span>+joinPoint.getArgs()[i]);</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">       }</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">   }</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">   <span style="color: #008000">//获取方法的签名,方法的名称，方法的返回类型</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">   Signature signature=joinPoint.getSignature();</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">   System.out.println(<span style="color: #006080">&quot;方法的名称  &quot;</span>+signature.getName());</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">} </pre><!--CRLF--></div></div><p>&nbsp;</p><hr /><p>&nbsp;</p><p><span style="font-size: 24px; "><strong>事务管理 </strong></span></p><p>仅用四个词解释事务</p><p>&nbsp;</p><p><strong> atomic(原子性):要么都发生，要么都不发生。 </strong></p><p><strong> consistent(一致性):数据应该不被破坏。 </strong></p><p><strong> Isolate(隔离性):用户间操作不相混淆</strong></p><p><strong> Durable(持久性):永久保存,例如保存到数据库中等</strong></p><p><strong><br /></strong></p><p>&nbsp;</p><p>Spring提供了两种事务管理方式:</p><ul><li>编程序事务管理 </li><li>声明式事务管理 </li></ul><p>&nbsp;</p><p>&nbsp;</p><h4><span>编程序事务管理</span></h4><p><span>编写程序式的事务管理可以清楚的定义事务的边界，可以实现细粒度的事务控制，比如可以通过程序代码来控制你的事务何时开始，何时结束等，与下面的声明式事务管理相比，它可以实现细粒度的事务控制。</span></p><p>&nbsp;</p><p>&nbsp;</p><h4><span>声明式事务管理</span></h4><p><span style="font-weight: normal"><span>如果并不需要细粒度的事务控制，可以使用声明式事务，在</span><span>Spring</span><span>中，只需要在</span><span>Spring</span><span>配置文件中做一些配置，即可将操作纳入到事务管理中，解除了和代码的耦合，这是对应用代码影响最小的选择，从这一点再次验证了</span><span>Spring</span><span>关于</span><span>AOP</span><span>的概念。当不需要事务管理的时候，可以直接从</span><span>Spring</span><span>配置文件中移除该设置.</span></span>需要引入用于事务管理的命名空间(tx).</p><p><span style="font-weight: normal"><span>Spring并没有直接管理事务,而是将事务的管理委托给其他的事务管理器实现.</span></span></p><p><span style="font-weight: normal"><span>Spring支持的事务管理器:</span></span></p><p>&nbsp;</p><ul><li><span>org.springframework.jdbc.datasource.</span><span>DataSourceTransactionManager</span> (<span>在单一的</span><span>JDBC Datasource</span><span>中的管理事务</span>) </li><li><span>org.springframework.orm.hibernate3.</span><span>HibernateTransactionManager</span> (<span>当持久化机制是</span><span>hibernate</span><span>时，用它来管理事务</span>) </li><li><span>org.springframework.jdo.</span><span>JdoTransactionManager</span> (<span>当持久化机制是</span><span>Jdo</span><span>时，用它来管理事务</span>) </li><li><span>org.springframework.transaction.jta.</span><span>JtaTransactionManager</span> <span>(使用一个</span><span>JTA</span><span>实现来管理事务。在一个事务跨越多个资源时必须使用</span>) </li><li><span>org.springframework.orm.ojb.</span><span>PersistenceBrokerTransactionManager</span> (<span>当</span><span>apache</span><span>的</span><span>ojb</span><span>用作持久化机制时，用它来管理事务</span>) </li></ul><p>基于XML文件配置事务管理器:</p><div id="codeSnippetWrapper" style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; width: 99%; font-family: 'Courier New', courier, monospace; direction: ltr; font-size: 10pt; overflow: auto; cursor: text; border: silver 1px solid; padding: 4px;"><div id="codeSnippet" style="text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">&lt;!--1 配置数据源--&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">&lt;bean id=<span style="color: #006080">&quot;dateSource&quot;</span> <span style="color: #0000ff">class</span>=<span style="color: #006080">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">   &lt;property name=<span style="color: #006080">&quot;username&quot;</span> value=<span style="color: #006080">&quot;root&quot;</span>/&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">   &lt;property name=<span style="color: #006080">&quot;password&quot;</span> value=<span style="color: #006080">&quot;root&quot;</span>/&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">   &lt;property name=<span style="color: #006080">&quot;url&quot;</span> value=<span style="color: #006080">&quot;jdbc:mysql://localhost:3306/test&quot;</span>/&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">   &lt;property name=<span style="color: #006080">&quot;driverClassName&quot;</span> value=<span style="color: #006080">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">   &lt;property name=<span style="color: #006080">&quot;maxActive&quot;</span> value=<span style="color: #006080">&quot;100&quot;</span>/&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    &lt;!-- 初始化连接数 --&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">   &lt;property name=<span style="color: #006080">&quot;initialSize&quot;</span> value=<span style="color: #006080">&quot;5&quot;</span>/&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">  </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">   &lt;!--最大空闲数,当洪峰退去时, 连接池所放的最少连接数--&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">   &lt;property name=<span style="color: #006080">&quot;maxIdle&quot;</span> value=<span style="color: #006080">&quot;8&quot;</span>/&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">   </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">   &lt;!--最小空闲数,当洪峰到来时,引起的性能开销 --&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">   &lt;property name=<span style="color: #006080">&quot;minIdle&quot;</span> value=<span style="color: #006080">&quot;5&quot;</span>/&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">&lt;/bean&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">  </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">&lt;!--2 配置JdbcTemplate模板,类似于dbutils,可数据访问操作--&gt;  </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">&lt;bean id=<span style="color: #006080">&quot;JdbcTemplate&quot;</span> <span style="color: #0000ff">class</span>=<span style="color: #006080">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    &lt;!-- 给JdbcTemplate注入数据源,调用JdbcAccessor中的setDataSource(DataSource dataSource)注入数据源--&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    &lt;property name=<span style="color: #006080">&quot;dataSource&quot;</span> ref=<span style="color: #006080">&quot;dateSource&quot;</span>/&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">&lt;/bean&gt;  </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">&nbsp;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">&nbsp;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">&lt;!-- 3 声明事务管理器(实际上,事务管理器就是一个切面),事务管理器将在获取连接时,返回一个打开事务的连接 --&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">&lt;bean id=<span style="color: #006080">&quot;txManager&quot;</span> <span style="color: #0000ff">class</span>=<span style="color: #006080">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    &lt;!-- 注入数据源,spring的jdbc事务管理器在管理事务时,依赖于JDBC的事务管理机制 --&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    &lt;property name=<span style="color: #006080">&quot;dataSource&quot;</span> ref=<span style="color: #006080">&quot;dateSource&quot;</span>/&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">&lt;/bean&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">&nbsp;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">&lt;!-- 4 配置通知 </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">     id=<span style="color: #006080">&quot;advice&quot;</span>:该属性的值就是通知的唯一标识</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">     transaction-manager:表示通知织入哪个切面</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">--&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">&lt;tx:advice id=<span style="color: #006080">&quot;advice&quot;</span> transaction-manager=<span style="color: #006080">&quot;txManager&quot;</span>&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">  &lt;tx:attributes&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    &lt;!-- tx:method的属性:</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">          * name 是必须的,表示与事务属性关联的方法名(业务方法名),对切入点进行细化。通配符（*）可以用来指定一批关联到相同的事务属性的方法。</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">                    如：<span style="color: #006080">'get*'</span>、<span style="color: #006080">'handle*'</span>、<span style="color: #006080">'on*Event'</span>等等.</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">          * propagation  不是必须的 ，默认值是REQUIRED </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">                            表示事务传播行为, 包括REQUIRED,SUPPORTS,MANDATORY,REQUIRES_NEW,NOT_SUPPORTED,NEVER,NESTED</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">          * isolation    不是必须的 默认值DEFAULT </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">                            表示事务隔离级别(数据库的隔离级别) </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">          * timeout      不是必须的 默认值-1(永不超时)</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">                            表示事务超时的时间（以秒为单位） </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">          </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">          * read-only    不是必须的 默认值false不是只读的 </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">                            表示事务是否只读？ </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">          </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">          * rollback-<span style="color: #0000ff">for</span> 不是必须的   </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">                            表示将被触发进行回滚的 Exception(s)；以逗号分开。</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">                            如：<span style="color: #006080">'com.foo.MyBusinessException,ServletException'</span> </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">          </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">          * no-rollback-<span style="color: #0000ff">for</span> 不是必须的  </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">                              表示不被触发进行回滚的 Exception(s)；以逗号分开。</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">                              如：<span style="color: #006080">'com.foo.MyBusinessException,ServletException'</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">                              </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">                              </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">        任何 RuntimeException 将触发事务回滚，但是任何 checked Exception 将不触发事务回滚                      </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">     --&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">     &lt;tx:method name=<span style="color: #006080">&quot;save*&quot;</span> propagation=<span style="color: #006080">&quot;REQUIRED&quot;</span> isolation=<span style="color: #006080">&quot;DEFAULT&quot;</span> read-only=<span style="color: #006080">&quot;false&quot;</span>/&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">     &lt;tx:method name=<span style="color: #006080">&quot;update*&quot;</span> propagation=<span style="color: #006080">&quot;REQUIRED&quot;</span> isolation=<span style="color: #006080">&quot;DEFAULT&quot;</span> read-only=<span style="color: #006080">&quot;false&quot;</span>/&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">     &lt;tx:method name=<span style="color: #006080">&quot;delete*&quot;</span> propagation=<span style="color: #006080">&quot;REQUIRED&quot;</span> isolation=<span style="color: #006080">&quot;DEFAULT&quot;</span> read-only=<span style="color: #006080">&quot;false&quot;</span>/&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">     &lt;!-- 其他的方法之只读的 --&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">     &lt;tx:method name=<span style="color: #006080">&quot;*&quot;</span> read-only=<span style="color: #006080">&quot;true&quot;</span>/&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">  &lt;/tx:attributes&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">&lt;/tx:advice&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">&nbsp;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">&lt;!-- 5 配置切入点 --&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">&lt;aop:config&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">  </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">  &lt;!-- 定义切入点，可以定义到类中所有的方法,之后在事务中在对方法进行细化 --&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">  &lt;aop:pointcut id=<span style="color: #006080">&quot;perform&quot;</span> expression=<span style="color: #006080">&quot;execution(* *.*(..))&quot;</span>/&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">  </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">  &lt;!-- 将通知和切入点关联起来--&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">  &lt;aop:advisor advice-ref=<span style="color: #006080">&quot;advice&quot;</span> pointcut-ref=<span style="color: #006080">&quot;perform&quot;</span>/&gt;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">&lt;/aop:config&gt; </pre><!--CRLF--></div></div><p>配置完事务管理器后,再常规的配置Bean注入对象.默认只有运行时异常才将导致事务回滚.</p><p>基于注解配置事务管理器:</p><p>XML配置文件中只需要声明事务管理器,而不需要给它&quot;灵魂&quot;,因为&quot;灵魂&quot;是由注解注入,所以需要注解解析器的支持:</p><p>&lt;tx:annotation-driven transaction-manager=&quot;txManager&quot;/&gt;</p><p>注册对事务注解进行解析的处理器,将注解与事务管理器关联起来即可.</p><div id="codeSnippetWrapper" style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; width: 99%; font-family: 'Courier New', courier, monospace; direction: ltr; font-size: 10pt; overflow: auto; cursor: text; border: silver 1px solid; padding: 4px;"><div id="codeSnippet" style="text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #008000">/**</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #008000"> *   方法的事务设置将被优先执行。</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #008000"> *   例如： BusinessService类在类的级别上被注解为只读事务，</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #008000"> *   但是，这个类中的 save 方法的@Transactional 注解的事</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #008000"> *   务设置将优先于类级别注解的事务设置。</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #008000"> *   默认的 @Transactional 设置如下：</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #008000"> *       事务传播设置是 PROPAGATION_REQUIRED</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #008000"> *       事务隔离级别是 ISOLATION_DEFAULT</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #008000"> *       事务是 读/写</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #008000"> *       事务超时默认是依赖于事务系统的，或者事务超时没有被支持</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #008000"> *       任何 RuntimeException 将触发事务回滚，但是任何 checked Exception 将不触发事务回滚</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #008000"> */</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">@Transactional(readOnly=true)</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> BusinessService {</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    @Resource(name=<span style="color: #006080">&quot;personDao&quot;</span>)</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    <span style="color: #0000ff">private</span> PersonDao personDao;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    @Transactional(readOnly=false,isolation=Isolation.DEFAULT,propagation=Propagation.REQUIRED)</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    <span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> save() <span style="color: #0000ff">throws</span> Exception{</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">        personDao.save();</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">        </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">        <span style="color: #0000ff">this</span>.update();</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    }</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    <span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> update() <span style="color: #0000ff">throws</span> Exception{</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">        personDao.save();</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">        </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">        personDao.update();</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    }</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">} </pre><!--CRLF--></div></div><p>&nbsp;</p><hr /><p>&nbsp;</p><p>小记:三大框架中最难的当属三大框架的整合,本文只是简单的将Spring的一些常见配置记下,诸如SpringMVC也不错,和StrutsMVC只是封装的不一样.Spring强大的声明式事务管理,常被用以业务层的封装.</p>