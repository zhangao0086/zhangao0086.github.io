---
layout: post
title: 'Struts1SH整合'
date: 2011-03-25 22:40:00
categories: [Java]
csdn_read_num: 5170
article_type: 1
---


<h4>Spring2.5+Hibernate3.5+Struts1.3整合开发</h4><p>为了避免出现jar包不兼容,或者重复加载的情况,先把jar包整理出来:</p><p><strong>hibernate核心安装包下的:<br /></strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hibernate3.jar<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lib/required/*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lib/optional/ehcache-1.2.3.jar<br /><strong>hibernate 注解安装包下的:</strong><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lib/test/slf4j-log4j12.jar<br /><strong>Spring安装包下的<br /></strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dist/spring.jar<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dist/modules/spring-webmvc-struts.jar<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lib/jakarta-commons/commons-logging.jar、commons-dbcp.jar、commons-pool.jar<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lib/aspectj/aspectjweaver.jar、aspectjrt.jar<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lib/cglib/cglib-nodep-2.1_3.jar<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lib/j2ee/common-annotations.jar<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lib/log4j/log4j-1.2.15.jar <br /><strong>Struts</strong><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; struts-1.3.8-lib.zip,需要使用到解压目录下的所有jar包,建议把jstl-1.0.2.jar和standard-1.0.2.jar更换为1.1版本。Spring中已经存在一个antlr-2.7.6.jar，所以把<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; struts中的antlr-2.7.2.jar删除，避免jar冲突.<br /><strong>数据库驱动</strong></p><p>替换旧的jar包,删除重复的jar包,jar包就准备好了,在此选用Mysql作为数据库,在临时数据库中创建一个person表,表的结构如下:</p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border-width: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><strong><span style="color: #0000ff">use</span></strong><span style="color: #000000">&nbsp;</span><span style="color: #000000">test</span><span style="color: #ff0000">;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><strong><span style="color: #0000ff">create</span></strong><span style="color: #000000">&nbsp;</span><strong><span style="color: #0000ff">table</span></strong><span style="color: #000000">&nbsp;</span><span style="color: #000000">person</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #ff0000">(</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">name</span><span style="color: #000000">&nbsp;</span><span style="color: #ff00ff">varchar</span><span style="color: #ff0000">(</span><strong><span style="color: #008080">12</span></strong><span style="color: #ff0000">)</span><span style="color: #ff0000">,</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">id</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #ff00ff">int</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #ff0000">)</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td>&nbsp;</td></tr></tbody></table></div><p>&nbsp;</p><hr /><p> 不要一开始就进行三大框架的整合,我们首先进行Spring与Hibernate的整合,然后再进行Spring与Struts的整合.  </p><p>把要做的事情整理好,能够便于我们开发:</p><p><strong>搭建Hibernate</strong></p><ul><li>创建表  </li><li>创建对应的javaBean---Person类,放置在domain包下  </li><li>创建PersonDao,提供一个save方法,接收一个Person对象,放置在dao下  </li><li>创建BusinessService,维护一个PersonDao对象,对外界提供save功能,放置在service下  </li><li>配置person.hbm.xml文件,放置在domain包下  </li><li>配置hibernate.cfg.xml,放置在类路径下</li></ul><p>表和实体创建好后,就开始配置person.hbm.xml文件:</p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border-width: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">hibernate-mapping</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">name:javaBean</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">table:对应的表名</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">class</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">..domain.Person</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> table</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">person</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">配置主键</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">id</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">id</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> type</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">integer</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">column</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">id</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/column</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">自增</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">generator</span><span style="color: #ff0000"> class</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">increment</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/generator</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/id</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">配置其他列</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">name</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> type</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">string</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">column</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">name</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> sql</span><span style="color: #8b0000">-type=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">varchar(12)</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/column</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/property</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/class</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/hibernate-mapping</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td>&nbsp;</td></tr></tbody></table></div><p>接下来配置hibernate.cfg.xml文件,相信大家对session-factory的配置很熟悉,就不再赘述了:</p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border-width: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">hibernate-configuration</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">session-factory</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">hibernate.connection.username</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">root</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/property</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">hibernate.connection.password</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">root</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/property</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">hibernate.connection.url</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">jdbc:mysql://localhost:3306/test</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/property</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">hibernate.connection.driver_class</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">com.mysql.jdbc.Driver</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/property</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">hibernate.dialect</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">org.hibernate.dialect.MySQL5Dialect</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/property</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">hibernate.show_sql</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">true</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/property</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">hibernate.hbm2ddl.auto</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">update</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/property</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">mapping</span><span style="color: #ff0000"> resource</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">../domain/Person.hbm.xml</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/session-factory</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/hibernate-configuration</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr></tbody></table></div><p>为了简化对数据库的操作,我们在PersonDao里面维护一个HibernateTemplate,标注注解,用Spring注入进来:</p><div style="line-height: 10px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border-width: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><span style="color: #000000">@Resource</span></td></tr><tr><td><strong><span style="color: #0000ff">private</span></strong><span style="color: #000000">&nbsp;</span><span style="color: #000000">HibernateTemplate</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">hibernateTemplate;</span></td></tr></tbody></table></div><p>同样,BusinessService维护的PersonDao也使用注解注入:</p><div style="line-height: 10px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border-width: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><span style="color: #000000">@Resource</span></td></tr><tr><td><strong><span style="color: #0000ff">private</span></strong><span style="color: #000000">&nbsp;</span><span style="color: #000000">PersonDao</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">personDao;</span></td></tr></tbody></table></div><p>Hibernate的搭建就完成了.  </p><hr /><p>由于目前为止没有使用到Struts,我们不用在WEB上对Spring+Hibernate进行测试,用junit或者main方法都可以,在此用main方法测试.</p><p><strong>搭建Spring</strong></p><ul><li>创建RegisterAction类(为后续的Struts作准备),在类加入main方法,放入web.action包中  </li><li>配置beans.xml文件,放在类路径下</li></ul><p>我们将在后面使用Spring的事务管理,所以要引入tx命名空间,事务管理器还需要被管理的切入点,不然就只是没有灵魂的空壳而已,aop命名空间也是必须的,还有对标注@Resource注解的字段进行注入,因而要引入context命名空间.</p><p>由于数据源在hibernate.cfg.xml文件中配置,hibernate中的session,就相当于Spring中的datasource,我们需要Spring获取hibernate.cfg.xml文件中的数据,Spring的org.springframework.orm.hibernate3包中,有着一系列整合hibernate框架的类,我们只需要使用LocalSessionFactoryBean类即可:</p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border-width: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">这是Spring整合Hibernate的入口</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">bean</span><span style="color: #ff0000"> id</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">sessionFactory</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> class</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">org.springframework.orm.hibernate3.LocalSessionFactoryBean</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">Spring生成sessionFactory需要Hibernate的配置文件Hibernate.cfg.xml</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">classpath:hibernate.cfg.xml:</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">表示在类路径下查找hibernate.cfg.xml文件,语法格式classpath:配置文件</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">configLocation</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> value</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">classpath:hibernate.cfg.xml</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">&nbsp;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/bean</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td>&nbsp;</td></tr></tbody></table></div><p>Spring标榜自己的声明式事务管理是多么多么的强大,我们不对事务管理器进行配置,岂不是白费了Spring的一番苦心?</p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border-width: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">Spring支持5种事务管理器,分别对应不同的委托机制,我们现在使用Hibernate,就要使用Hibernate的事务管理器实现.</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">Spring支持的5种事务管理器:</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">org.springframework.jdbc.datasource.DataSourceTransactionManager</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">org.springframework.orm.hibernate3.HibernateTransactionManager</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">org.springframework.jdo.JdoTransactionManager</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">org.springframework.transaction.jta.JtaTransactionManager</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">org.springframework.orm.ojb.PersistenceBrokerTransactionManager</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">bean</span><span style="color: #ff0000"> id</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">txManager</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> class</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">org.springframework.orm.hibernate3.HibernateTransactionManager</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">sessionFactory</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> ref</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">sessionFactory</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/property</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/bean</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td>&nbsp;</td></tr></tbody></table></div><p>接下来该配置事务管理器的通知(其实事务管理器就是一个切面):</p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border-width: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">配置通知</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">transaction-manager:</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">表示通知织入到的切面</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">--&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">tx:advice</span><span style="color: #ff0000"> id</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">advice</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> transaction</span><span style="color: #8b0000">-manager=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">txManager</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">tx:attributes</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">tx:method</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">save*</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> read</span><span style="color: #8b0000">-only=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">false</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> isolation</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">DEFAULT</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> propagation</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">REQUIRED</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">如果是其它方法</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">tx:method</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">*</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> read</span><span style="color: #8b0000">-only=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">true</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/tx:attributes</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/tx:advice</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr></tbody></table></div><p>切入点:</p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border-width: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">配置切入点</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">aop:config</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">aop:pointcut</span><span style="color: #ff0000"> id</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">perform</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> expression</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">execution(*</span><span style="color: #0000ff">&nbsp;</span><span style="color: #0000ff">..service..*.*(..))</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">本文所有包名都用..代替,此表达式包名有误</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">aop:advisor</span><span style="color: #ff0000"> pointcut</span><span style="color: #8b0000">-ref=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">perform</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> advice</span><span style="color: #8b0000">-ref=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">advice</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/aop:config</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr></tbody></table></div><p>由于PersonDao中维护了一个HibernateTemplate,BusinessService中维护了一个PersonDao,我们需要在配置文件中对它们进行注入:</p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border-width: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">HibernateTemplate</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">bean</span><span style="color: #ff0000"> id</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">hibernateTemplat</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> class</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">org.springframework.orm.hibernate3.HibernateTemplate</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">sessionFactory</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> ref</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">sessionFactory</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/property</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/bean</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">Dao层对象</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">bean</span><span style="color: #ff0000"> id</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">personDao</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> class</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">.t.dao.PersonDao</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/bean</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">配置业务层对象</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">bean</span><span style="color: #ff0000"> id</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">service</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> class</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">..service.BusinessService</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/bean</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">注册注解解析器</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">context:annotation-config</span><span style="color: #0000ff">&gt;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/context:annotation-config</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span></td></tr></tbody></table></div><p>最后再在RegisterAction中进行测试,RegisterAction:</p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border-width: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><strong><span style="color: #0000ff">public</span></strong><span style="color: #000000">&nbsp;</span><strong><span style="color: #0000ff">class</span></strong><span style="color: #000000">&nbsp;</span><span style="color: #000000">RegisterAction</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">{</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #008000">//</span><span style="color: #008000">由于只是测试,不需要继承Action</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><strong><span style="color: #0000ff">public</span></strong><span style="color: #000000">&nbsp;</span><strong><span style="color: #0000ff">static</span></strong><span style="color: #000000">&nbsp;</span><strong><span style="color: #00008b">void</span></strong><span style="color: #000000">&nbsp;</span><span style="color: #000000">main(String[]</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">args)</span><span style="color: #000000">&nbsp;</span><strong><span style="color: #0000ff">throws</span></strong><span style="color: #000000">&nbsp;</span><span style="color: #000000">Exception</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">{</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">ApplicationContext</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">act</span><span style="color: #000000">&nbsp;</span><span style="color: #ff0000">=</span><span style="color: #000000">&nbsp;</span><strong><span style="color: #0000ff">new</span></strong><span style="color: #000000">&nbsp;</span><span style="color: #000000">ClassPathXmlApplicationContext(</span><strong><span style="color: #008080">&quot;</span><span style="color: #008080">beans.xml</span><span style="color: #008080">&quot;</span></strong><span style="color: #000000">);</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">BusinessService</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">service</span><span style="color: #000000">&nbsp;</span><span style="color: #ff0000">=</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">(BusinessService)</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">act</span><span style="color: #ff0000">.</span><span style="color: #000000">getBean(</span><strong><span style="color: #008080">&quot;</span><span style="color: #008080">service</span><span style="color: #008080">&quot;</span></strong><span style="color: #000000">);</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">Person</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">person</span><span style="color: #000000">&nbsp;</span><span style="color: #ff0000">=</span><span style="color: #000000">&nbsp;</span><strong><span style="color: #0000ff">new</span></strong><span style="color: #000000">&nbsp;</span><span style="color: #000000">Person();</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #008000">//</span><span style="color: #008000">id设置了自增,不用管</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">person</span><span style="color: #ff0000">.</span><span style="color: #000000">setName(</span><strong><span style="color: #008080">&quot;</span><span style="color: #008080">zhang</span><span style="color: #008080">&quot;</span></strong><span style="color: #000000">);</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">service</span><span style="color: #ff0000">.</span><span style="color: #000000">save(person);</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">}</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #000000">}</span><span style="color: #000000">&nbsp;</span></td></tr></tbody></table></div><p>注:由于PersonDao和BusinessService都没有实现接口,故代理对象使用cglib库生成目标对象的子类.如果对事务管理器工作产生怀疑,可以在dao中分别抛出运行时异常和编译时异常进行测试.</p><hr /><p><strong>搭建Struts</strong></p><ul><li>创建register.jsp和success.jsp文件,直接放在根目录下  </li><li>RegisterAction继承自DispatchAction  </li><li>维护一个BusinessService,由Spring运行时注入  </li><li>配置struts-config.xml  </li><li>配置web.xml</li></ul><p>register.jsp文件中只需要简单的一个表单即可,一个文本框,一个提交按钮,用不用Stusts的标签库都行,不过,我为了方便,在表单里面增加了一个隐藏域:</p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border-width: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><span style="color: #000000">&lt;input</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">type</span><span style="color: #ff0000">=</span><span style="color: #4682b4">&quot;</span><span style="color: #4682b4">hidden</span><span style="color: #4682b4">&quot;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">name</span><span style="color: #ff0000">=</span><span style="color: #4682b4">&quot;</span><span style="color: #4682b4">method</span><span style="color: #4682b4">&quot;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">value</span><span style="color: #ff0000">=</span><span style="color: #4682b4">&quot;</span><span style="color: #4682b4">save</span><span style="color: #4682b4">&quot;</span><span style="color: #000000">&nbsp;</span><span style="color: #8b0000">/&gt;</span></td></tr></tbody></table></div><p>待会在Struts的配置文件中对方法进行转发就行了.</p><p>success.jsp文件中也随便输出什么就行了,只要是看到就代表Action的跳转成功了.</p><p>把RegisterAction稍微修改一下:</p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border-width: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><span style="color: #ff00ff">public</span><span style="color: #000000">&nbsp;</span><span style="color: #ff00ff">class</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">RegisterAction</span><span style="color: #000000">&nbsp;</span><span style="color: #ff00ff">extends</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">DispatchAction</span><span style="color: #000000">{</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #ffd700">/</span><span style="color: #ff0000">*</span><span style="color: #ff0000">*</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;</span><span style="color: #ff0000">*</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">加了点形参</span><span style="color: #ff0000">,</span><span style="color: #000000">接收Struts传递的对象</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;</span><span style="color: #ff0000">*</span><span style="color: #ffd700">/</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #ff00ff">public</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">ActionForward</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">save</span><span style="color: #ff0000">(</span><span style="color: #000000">ActionMapping</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">mapping</span><span style="color: #ff0000">,</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">ActionForm</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">form</span><span style="color: #ff0000">,</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">HttpServletRequest</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">request</span><span style="color: #ff0000">,</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">HttpServletResponse</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">response</span><span style="color: #ff0000">)</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">{</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">ApplicationContext</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">act</span><span style="color: #000000">&nbsp;</span><span style="color: #ff0000">=</span><span style="color: #000000">&nbsp;</span><span style="color: #ff00ff">new</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">ClassPathXmlApplicationContext</span><span style="color: #ff0000">(</span><span style="color: #4682b4">&quot;</span><span style="color: #4682b4">beans.xml</span><span style="color: #4682b4">&quot;</span><span style="color: #ff0000">)</span><span style="color: #ff0000">;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">BusinessService</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">service</span><span style="color: #000000">&nbsp;</span><span style="color: #ff0000">=</span><span style="color: #000000">&nbsp;</span><span style="color: #ff0000">(</span><span style="color: #000000">BusinessService</span><span style="color: #ff0000">)</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">act.getBean</span><span style="color: #ff0000">(</span><span style="color: #4682b4">&quot;</span><span style="color: #4682b4">service</span><span style="color: #4682b4">&quot;</span><span style="color: #ff0000">)</span><span style="color: #ff0000">;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">Person</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">person</span><span style="color: #000000">&nbsp;</span><span style="color: #ff0000">=</span><span style="color: #000000">&nbsp;</span><span style="color: #ff00ff">new</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">Person</span><span style="color: #ff0000">(</span><span style="color: #ff0000">)</span><span style="color: #ff0000">;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">person.setName</span><span style="color: #ff0000">(</span><span style="color: #000000">request.getParameter</span><span style="color: #ff0000">(</span><span style="color: #4682b4">&quot;</span><span style="color: #4682b4">name</span><span style="color: #4682b4">&quot;</span><span style="color: #ff0000">)</span><span style="color: #ff0000">)</span><span style="color: #ff0000">;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">service.save</span><span style="color: #ff0000">(</span><span style="color: #000000">person</span><span style="color: #ff0000">)</span><span style="color: #ff0000">;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #ff00ff">return</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">mapping.findForward</span><span style="color: #ff0000">(</span><span style="color: #4682b4">&quot;</span><span style="color: #4682b4">success</span><span style="color: #4682b4">&quot;</span><span style="color: #ff0000">)</span><span style="color: #ff0000">;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">}</span></td></tr><tr><td><span style="color: #000000">}</span></td></tr></tbody></table></div><p>在WEB-INF下配置Struts的Action映射信息:</p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border-width: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">struts-config</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">action-mappings</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">action</span><span style="color: #ff0000"> path</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">/register</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">&nbsp;</span></td></tr><tr><td><span style="color: #8b0000">&nbsp;&nbsp;&nbsp; </span><span style="color: #8b0000">&nbsp;&nbsp;&nbsp; </span><span style="color: #8b0000">&nbsp;&nbsp;&nbsp; </span><span style="color: #ff0000">&nbsp;&nbsp;&nbsp; type</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;.</span><span style="color: #0000ff">.web.action.RegisterAction</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">&nbsp;</span></td></tr><tr><td><span style="color: #8b0000">&nbsp;&nbsp;&nbsp; </span><span style="color: #8b0000">&nbsp;&nbsp;&nbsp; </span><span style="color: #8b0000">&nbsp;&nbsp;&nbsp; </span><span style="color: #ff0000">&nbsp;&nbsp;&nbsp; scope</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">request</span><span style="color: #0000ff">&quot;</span></td></tr><tr><td><span style="color: #8b0000">&nbsp;&nbsp;&nbsp; </span><span style="color: #8b0000">&nbsp;&nbsp;&nbsp; </span><span style="color: #8b0000">&nbsp;&nbsp;&nbsp; </span><span style="color: #ff0000">&nbsp;&nbsp;&nbsp; parameter</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">method</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;&nbsp;&nbsp; //跟register.jsp中隐藏域的值对应</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">forward</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">success</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> path</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">/success.jsp</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/forward</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/action</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/action-mappings</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/struts-config</span><span style="color: #0000ff">&gt;</span></td></tr></tbody></table></div><p>再将ActionServlet在web.xml文件中映射进来就行了.</p><p>测试,如果跳转到success.jsp页面就代表成功了.</p><p>&nbsp;</p><hr /><p> 好了,程序逻辑就是这样,但是有<strong>三点需要注意</strong>,首先,Hibernate的配置文件中配置了一个连接池,这是Hibernate的开发者为了让人们学习Hibernate而开发的一个简易连接池,这个连接池在实际应用中是有BUG的,不能使用.那么我们就要在Spring里面配置连接池,并且要交由Spring管理:  </p><p>Hibernate配置文件修改后如下:</p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border-width: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">hibernate-configuration</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">session-factory</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">hibernate.dialect</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">org.hibernate.dialect.MySQL5Dialect</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/property</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">hibernate.show_sql</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">true</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/property</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">hibernate.hbm2ddl.auto</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">update</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/property</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">mapping</span><span style="color: #ff0000"> resource</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;..</span><span style="color: #0000ff">/../domain/Person.hbm.xml</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/session-factory</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/hibernate-configuration</span><span style="color: #0000ff">&gt;</span></td></tr></tbody></table></div><p>删除了关于连接的信息,然后在Spring的配置文件中加上连接池,以c3p0为例:</p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border-width: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">配置数据源</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">bean</span><span style="color: #ff0000"> id</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">dataSource</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> class</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">com.mchange.v2.c3p0.ComboPooledDataSource</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> destroy</span><span style="color: #8b0000">-method=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">close</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">driverClass</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> value</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">com.mysql.jdbc.Driver</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">&nbsp;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">jdbcUrl</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> value</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">jdbc:mysql://localhost:3306/test?useUnicode=true&amp;amp;characterEncoding=GBK</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">user</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> value</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">root</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">&nbsp;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">password</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> value</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">root</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">&nbsp;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&lt;!--</span><span style="color: #008000">连接池中保留的最小连接数。</span><span style="color: #008000">--&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">minPoolSize</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> value</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">5</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">&nbsp;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&lt;!--</span><span style="color: #008000">连接池中保留的最大连接数。Default:</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">15</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">maxPoolSize</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> value</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">30</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">&nbsp;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&lt;!--</span><span style="color: #008000">初始化时获取的连接数，取值应在minPoolSize与maxPoolSize之间。Default:</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">3</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">initialPoolSize</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> value</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">10</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&lt;!--</span><span style="color: #008000">最大空闲时间,60秒内未使用则连接被丢弃。若为0则永不丢弃。Default:</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">0</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">maxIdleTime</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> value</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">60</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&lt;!--</span><span style="color: #008000">当连接池中的连接耗尽的时候c3p0一次同时获取的连接数。Default:</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">3</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">acquireIncrement</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> value</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">5</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">&nbsp;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&lt;!--</span><span style="color: #008000">JDBC的标准参数，用以控制数据源内加载的PreparedStatements数量。但由于预缓存的statements</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">属于单个connection而不是整个连接池。所以设置这个参数需要考虑到多方面的因素。</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">如果maxStatements与maxStatementsPerConnection均为0，则缓存被关闭。Default:</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">0</span><span style="color: #008000">--&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">maxStatements</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> value</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">0</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">&nbsp;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&lt;!--</span><span style="color: #008000">每60秒检查所有连接池中的空闲连接。Default:</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">0</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">idleConnectionTestPeriod</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> value</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">60</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">&nbsp;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&lt;!--</span><span style="color: #008000">定义在从数据库获取新连接失败后重复尝试的次数。Default:</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">30</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">acquireRetryAttempts</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> value</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">30</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">&nbsp;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&lt;!--</span><span style="color: #008000">获取连接失败将会引起所有等待连接池来获取连接的线程抛出异常。但是数据源仍有效</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">保留，并在下次调用getConnection()的时候继续尝试获取连接。如果设为true，那么在尝试</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">获取连接失败后该数据源将申明已断开并永久关闭。Default:</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">false</span><span style="color: #008000">--&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">breakAfterAcquireFailure</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> value</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">true</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">&nbsp;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/bean</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td>&nbsp;</td></tr></tbody></table></div><p>在Spring的配置文件中加入这个还不够,它虽然知道有这么个连接池,但是没有管理起来,我们需要增加Spring在创建SessionFactory时的参数:</p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border-width: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">创建本地化工厂Bean,这是Spring整合Hibernate的入口</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">bean</span><span style="color: #ff0000"> id</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">sessionFactory</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> class</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">org.springframework.orm.hibernate3.LocalSessionFactoryBean</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">不得不说Spring的这玩意设计的很好,有dataSource这个属性,</span></td></tr><tr><td><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">dataSource就对应Hibernate中的sessionFactory</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">--&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">dataSource</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> ref</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">dataSource</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/property</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">Spring生成sessionFactory需要Hibernate的配置文件Hibernate.cfg.xml</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">classpath:hibernate.cfg.xml:</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">表示在类路径下查找hibernate.cfg.xml文件,语法格式classpath:配置文件</span></td></tr><tr><td><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">--&gt;</span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">configLocation</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> value</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">classpath:hibernate.cfg.xml</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">&nbsp;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/bean</span><span style="color: #0000ff">&gt;</span></td></tr></tbody></table></div><p>这样一来,Spring就会管理这个连接池,池也能发挥作用了.第一点需要注意的就是Hibernate的池并不好用,学习娱乐一下没有问题,不要放在真正的项目上面去.</p><p>第二点就是Action中的BusinessService需要由Spring注入进来,而不是在同一个Action中都写上相同的获取BusinessService的代码.好吧,也许这个很简单,就不用说了...</p><p>第三点.</p><p>就是当你以为第二点很简单的时候你就错了!你要知道Action是什么时候创建的,它是由Spring创建的吗?Spring会在Struts创建这个Action的时候给它注入对象吗?Struts1中的Action只有一个,且都是在服务器初始化的时候一并初始化的,想要让Spring注入这个对象,至少也要让Spring在服务器初始化的时候加载进来</p><p><span style="color: #000000">ApplicationContext</span><span style="color: #000000"> </span><span style="color: #000000">act</span><span style="color: #000000"> </span><span style="color: #ff0000">=</span><span style="color: #000000"> </span><span style="color: #ff00ff">new</span><span style="color: #000000"> </span><span style="color: #000000">ClassPathXmlApplicationContext</span><span style="color: #ff0000">(</span><span style="color: #4682b4">&quot;</span><span style="color: #4682b4">beans.xml</span><span style="color: #4682b4">&quot;</span><span style="color: #ff0000">)</span><span style="color: #ff0000">;</span></p><p>这段代码只能在程序运行时加载beans.xml文件,我们要让beans.xml文件随服务器的启动而启动,就需要配置上下文参数:</p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border-width: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">context-param</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">param-name</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">contextConfigLocation</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/param-name</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">加载beans.xml文件的方法二:classpath:beans.xml</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">param-value</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">/WEB-INF/classes/beans.xml</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/param-value</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/context-param</span><span style="color: #0000ff">&gt;</span></td></tr></tbody></table></div><p>这段代码放在web.xml文件中,启动web应用的时候,这些参数就被读取到了ServletContext中,,整个web应用程序都共享这个上下文参数,注意和&lt;init-param&gt;标签不同,&lt;init-param&gt;是servlet范围内的参数,只能在servlet的init()方法中取得.</p><p>好了,光有上下文参数还不够,它只是以<span style="color: #000000">contextConfigLocation</span>为Key,存储在ServletContext中而已,我们要让Spring容器启动,还是得用老办法:</p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border-width: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><span style="color: #008000">&lt;!--</span><span style="color: #008000"> 通过servlet配置Spring容器随Web应用的启动而初始化 </span><span style="color: #008000">--&gt;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">servlet</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">servlet-name</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">contextLoader</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/servlet-name</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">servlet-class</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">org.springframework.web.context.ContextLoaderServlet</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/servlet-class</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">load-on-startup</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">2</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/load-on-startup</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/servlet</span><span style="color: #0000ff">&gt;</span></td></tr></tbody></table></div><p>让<span style="color: #000000">ContextLoaderServlet</span> 这个类加载,然后读取<span style="color: #000000">contextConfigLocation的数据,从而启动Spring,但是我并没有在这里指定读取哪个文件,也没有告诉它读取ServletContext中的<span style="color: #000000">contextConfigLocation,那么它是如何知道的呢?</span></span></p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border-width: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><strong><span style="color: #0000ff">public</span></strong><span style="color: #000000">&nbsp;</span><strong><span style="color: #0000ff">static</span></strong><span style="color: #000000">&nbsp;</span><strong><span style="color: #0000ff">final</span></strong><span style="color: #000000">&nbsp;</span><span style="color: #000000">String</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">CONFIG_LOCATION_PARAM</span><span style="color: #000000">&nbsp;</span><span style="color: #ff0000">=</span><span style="color: #000000">&nbsp;</span><strong><span style="color: #008080">&quot;</span><span style="color: #008080">contextConfigLocation</span><span style="color: #008080">&quot;</span></strong><span style="color: #000000">;</span></td></tr></tbody></table></div><p>ContextLoaderServlet里面维护了一个ContextLoader,上面这个字符串常量是ContextLoader中的一人属性,那么就不用再说什么了吧?Spring会自动去找这个Key.</p><p>启动Spring就没有问题了,但是这样还不够,事实上我们需要在Struts创建Action的时候把BusinessService注入进来,这就需要我们对Struts的工作机制有相当的了解.Struts在工作的时候,使用了很多Processor(处理程序),每个处理程序都只完成一个功能,我们要利用Struts的这个特点,在适当的位置加入一个处理程序,然后注入对象.不过,Spring已经帮我们完成了这个功能,毕竟它号称支持全部主流框架,我们需要用到一个处理程序,但是不用考虑实现细节,修改后的Struts-config.xml文件如下:</p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">struts-config</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">action-mappings</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">action</span><span style="color: #ff0000"> path</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">/register</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">&nbsp;</span></td></tr><tr><td><span style="color: #8b0000">&nbsp;&nbsp;&nbsp; </span><span style="color: #8b0000">&nbsp;&nbsp;&nbsp; </span><span style="color: #8b0000">&nbsp;&nbsp;&nbsp; </span><span style="color: #ff0000">&nbsp;&nbsp;&nbsp; scope</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">request</span><span style="color: #0000ff">&quot;</span></td></tr><tr><td><span style="color: #8b0000">&nbsp;&nbsp;&nbsp; </span><span style="color: #8b0000">&nbsp;&nbsp;&nbsp; </span><span style="color: #8b0000">&nbsp;&nbsp;&nbsp; </span><span style="color: #ff0000">&nbsp;&nbsp;&nbsp; parameter</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">method</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">forward</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">success</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> path</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">/success.jsp</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/forward</span><span style="color: #0000ff">&gt;</span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/action</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/action-mappings</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">ActionServlet中所有的工作委托给RequestProcessor负责</span></td></tr><tr><td><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">controller:struts中ActionServlet把请求委托给processorClass属性所指定的类来完成</span></td></tr><tr><td><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span></td></tr><tr><td><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">*</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">org.springframework.web.struts.DelegatingRequestProcessor该类完成</span></td></tr><tr><td><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">spring负责创建struts的Action对象,并注入业务层对象,剩下的工作仍由Struts完成</span></td></tr><tr><td><span style="color: #008000">&nbsp;&nbsp;&nbsp; </span><span style="color: #008000">--&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">controller</span><span style="color: #ff0000"> processorClass</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">org.springframework.web.struts.DelegatingRequestProcessor</span><span style="color: #0000ff">&quot;</span><span style="color: #8b0000">/</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/struts-config</span><span style="color: #0000ff">&gt;</span></td></tr></tbody></table></div><p>关键就是最后一句.注意:上面action中没有type属性,因为已经不需要了,写了也没有用,这是因为只要有<span style="color: #0000ff">DelegatingRequestProcessor</span> 这个处理程序在,Struts读取这个配置文件的时候,它就会拿path指定的值去找Spring中的bean,意味着你其他不想要这样处理的action也要这样处理,不过Spring里面也很简单:</p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><span style="color: #008000">&lt;!--</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">配置RegisterAction</span><span style="color: #008000">&nbsp;</span><span style="color: #008000">--&gt;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">bean</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">/register</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> class</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">..web.action.RegisterAction</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">property</span><span style="color: #ff0000"> name</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">service</span><span style="color: #0000ff">&quot;</span><span style="color: #ff0000"> ref</span><span style="color: #8b0000">=</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">service</span><span style="color: #0000ff">&quot;</span><span style="color: #0000ff">&gt;</span><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/property</span><span style="color: #0000ff">&gt;</span></td></tr><tr><td><span style="color: #0000ff">&lt;</span><span style="color: #8b0000">/bean</span><span style="color: #0000ff">&gt;</span></td></tr></tbody></table></div><p>就像这样,在Spring中加上这个一个bean就可以了,注意它和action的path属性值是一样的.最后修改的RegisterAction如下:</p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><strong><span style="color: #0000ff">public</span></strong><span style="color: #000000">&nbsp;</span><strong><span style="color: #0000ff">class</span></strong><span style="color: #000000">&nbsp;</span><span style="color: #000000">RegisterAction</span><span style="color: #000000">&nbsp;</span><strong><span style="color: #0000ff">extends</span></strong><span style="color: #000000">&nbsp;</span><span style="color: #000000">DispatchAction</span><span style="color: #000000">{</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><strong><span style="color: #0000ff">private</span></strong><span style="color: #000000">&nbsp;</span><span style="color: #000000">BusinessService</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">service;<br /></span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><strong><span style="color: #0000ff">public</span></strong><span style="color: #000000">&nbsp;</span><span style="color: #000000">ActionForward</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">save(ActionMapping</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">mapping,</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">ActionForm</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">form,</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">HttpServletRequest</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">request,</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">HttpServletResponse</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">response)</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">{</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">Person</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">person</span><span style="color: #000000">&nbsp;</span><span style="color: #ff0000">=</span><span style="color: #000000">&nbsp;</span><strong><span style="color: #0000ff">new</span></strong><span style="color: #000000">&nbsp;</span><span style="color: #000000">Person();</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">person</span><span style="color: #ff0000">.</span><span style="color: #000000">setName(request</span><span style="color: #ff0000">.</span><span style="color: #000000">getParameter(</span><strong><span style="color: #008080">&quot;</span><span style="color: #008080">name</span><span style="color: #008080">&quot;</span></strong><span style="color: #000000">));</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><strong><span style="color: #0000ff">this</span></strong><span style="color: #ff0000">.</span><span style="color: #000000">service</span><span style="color: #ff0000">.</span><span style="color: #000000">save(person);</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><strong><span style="color: #0000ff">return</span></strong><span style="color: #000000">&nbsp;</span><span style="color: #000000">mapping</span><span style="color: #ff0000">.</span><span style="color: #000000">findForward(</span><strong><span style="color: #008080">&quot;</span><span style="color: #008080">success</span><span style="color: #008080">&quot;</span></strong><span style="color: #000000">);</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">}</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><strong><span style="color: #0000ff">public</span></strong><span style="color: #000000">&nbsp;</span><strong><span style="color: #00008b">void</span></strong><span style="color: #000000">&nbsp;</span><span style="color: #000000">setService(BusinessService</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">service)</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">{</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><strong><span style="color: #0000ff">this</span></strong><span style="color: #ff0000">.</span><span style="color: #000000">service</span><span style="color: #000000">&nbsp;</span><span style="color: #ff0000">=</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">service;</span></td></tr><tr><td><span style="color: #000000">&nbsp;&nbsp;&nbsp; </span><span style="color: #000000">}</span></td></tr><tr><td><span style="color: #000000">}</span></td></tr></tbody></table></div><p>已经不需要多余的代码了,对象由Spring注入进来,然后剩下工作由Struts完成.没有解决中文乱码的问题.不过整合已经完成了.</p><p>&nbsp;</p><hr /><p>&nbsp;</p><hr /><p>另外,再提供另外一种解决方案,称做&quot;分离&quot;,可以不必让Struts和Spring耦合的这么紧.</p><p>由于web.xml文件中已经将beans.xml读取到ServletContext中了,我们可以使用工具类读取ServletContext里面beans.xml的配置信息.先将beans.xml文件中关于action的配置删掉,再将Struts-config.xml文件中的处理程序删掉,给action配上type,就样就是一个传统的action配置.现在,Struts和Spring中已经没有各自的配置项了,是不是已经解耦了呢?不过光这样还不行,我们要修改RegisterAction中的代码,只需要加入两行而已:</p><div style="line-height: 20px; font-family: courier new; font-size: 12px"> <table style="width: 100%; border: 0px; padding: 0px;" border="0" cellspacing="0"><tbody><tr><td><span style="color: #000000">WebApplicationContext</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">wct</span><span style="color: #000000">&nbsp;</span><span style="color: #ff0000">=</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">WebApplicationContextUtils</span><span style="color: #ff0000">.</span><span style="color: #000000">getWebApplicationContext(</span><strong><span style="color: #0000ff">this</span></strong><span style="color: #ff0000">.</span><span style="color: #000000">getServlet()</span><span style="color: #ff0000">.</span><span style="color: #000000">getServletContext());</span></td></tr><tr><td><span style="color: #000000">service</span><span style="color: #000000">&nbsp;</span><span style="color: #ff0000">=</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">(BusinessService)</span><span style="color: #000000">&nbsp;</span><span style="color: #000000">wct</span><span style="color: #ff0000">.</span><span style="color: #000000">getBean(</span><strong><span style="color: #008080">&quot;</span><span style="color: #008080">service</span><span style="color: #008080">&quot;</span></strong><span style="color: #000000">);</span></td></tr></tbody></table></div><p>第一句是利用<span style="color: #000000">WebApplicationContextUtils</span>工具类获取ServletContext中beans.xml文件的配置信息,然后就可以得到bean了.这样就完成了分离.</p><hr style="width: 973px; height: 21px;" size="21" /><p> Spring2.5+Hibernate3.5+Struts1.3的整合就至此为止了,如果本文存在什么问题,请及时提出来,感激不尽..</p>