---
layout: post
title: '模拟浏览器向服务器发送和接收数据'
date: 2011-02-17 17:01:00
categories: [Java]
csdn_read_num: 10370
article_type: 1
---


<p>创建一个服务器程序,用来接收和返回数据:</p><div id="codeSnippetWrapper" style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; width: 99%; font-family: 'Courier New', courier, monospace; direction: ltr; font-size: 10pt; overflow: auto; cursor: text; border: silver 1px solid; padding: 4px;"><div id="codeSnippet" style="text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> doGet(HttpServletRequest request, HttpServletResponse response)</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">        <span style="color: #0000ff">throws</span> ServletException, IOException {</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    System.out.println(request.getMethod());                <span style="color: #008000">//获取请求方式</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    System.out.println(request.getHeader(<span style="color: #006080">&quot;referer&quot;</span>));       <span style="color: #008000">//获取请求页面</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    System.out.println(request.getParameter(<span style="color: #006080">&quot;name&quot;</span>));       <span style="color: #008000">//获取参数</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    response.getOutputStream().write(<span style="color: #006080">&quot;Hello&quot;</span>.getBytes());   <span style="color: #008000">//向浏览器回送数据</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">}</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> doPost(HttpServletRequest request, HttpServletResponse response)</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">        <span style="color: #0000ff">throws</span> ServletException, IOException {</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    doGet(request, response);</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">}</pre><!--CRLF--></div></div><p>接下来,再创建一个Java程序向这个服务器程序发送请求,类 HttpURLConnection提供方法获取和发送请求数据.但是<span><strong>构造方法 </strong></span></p><p><span><strong></strong></span><span><code>&nbsp;&nbsp;&nbsp; protected </code></span><code><strong>HttpURLConnection</strong>(URL u)</code></p><p>表明我们不能直接创建这个对象,也没有任何静态方法能够返回这个对象.于是我们需要绕一把..先获得 URL对象,再利用<code><strong>openConnection</strong>()返回</code><span><strong>HttpURLConnection</strong>对象<strong>:</strong></span></p><div id="codeSnippetWrapper" style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; width: 99%; font-family: 'Courier New', courier, monospace; direction: ltr; font-size: 10pt; overflow: auto; cursor: text; border: silver 1px solid; padding: 4px;"><div id="codeSnippet" style="text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> sendHttp() <span style="color: #0000ff">throws</span> IOException{  </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    URL url = <span style="color: #0000ff">new</span> URL(<span style="color: #006080">&quot;http://localhost:8080/ImitateRequest/servlet/servlet&quot;</span>);    <span style="color: #008000">//设置要访问的链接  </span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    HttpURLConnection conn = (HttpURLConnection) url.openConnection();            <span style="color: #008000">//获取HttpURLConnection的对象  </span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">      </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    conn.setDoOutput(true);                      <span style="color: #008000">//默认值为false,不能传递参数  </span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    conn.setRequestMethod(<span style="color: #006080">&quot;POST&quot;</span>);                                                <span style="color: #008000">//设置请求方式  </span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    conn.setRequestProperty(<span style="color: #006080">&quot;referer&quot;</span>, <span style="color: #006080">&quot;http://www.sina.com/index.html&quot;</span>);  </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    OutputStream out = conn.getOutputStream();  </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    out.write(<span style="color: #006080">&quot;name=aaaa&quot;</span>.getBytes());           <span style="color: #008000">//向服务器发送一个值为&quot;aaaa&quot;的name参数,如果conn的DoOutput属性值为false,此处将抛出异常  </span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">      </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    conn.getResponseCode();                      <span style="color: #008000">//获取响应状态码  </span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">}  </pre><!--CRLF--></div></div><p>以上是发送一次请求需要掌握的方法,接下来是读取一次请求:</p><div id="codeSnippetWrapper" style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; width: 99%; font-family: 'Courier New', courier, monospace; direction: ltr; font-size: 10pt; overflow: auto; cursor: text; border: silver 1px solid; padding: 4px;"><div id="codeSnippet" style="text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;"><span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> readHttp() <span style="color: #0000ff">throws</span> IOException{</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">        URL url = <span style="color: #0000ff">new</span> URL(<span style="color: #006080">&quot;http://localhost:8080/ImitateRequest/servlet/servlet&quot;</span>);    <span style="color: #008000">//设置请求的链接</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">        HttpURLConnection conn = (HttpURLConnection) url.openConnection();</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">        </pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">        System.out.println(conn.getResponseCode());                      <span style="color: #008000">//查看响应状态码</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">        System.out.println(conn.getHeaderField(<span style="color: #006080">&quot;Content-Length&quot;</span>));       <span style="color: #008000">//响应文本内容的长度</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">        InputStream in = conn.getInputStream();                          <span style="color: #008000">//获取一个和服务器返回的内容相关联的流</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">        <span style="color: #0000ff">try</span>{</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">            <span style="color: #0000ff">int</span> len = 0;</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">            <span style="color: #0000ff">byte</span>[] buffer = <span style="color: #0000ff">new</span> <span style="color: #0000ff">byte</span>[1024];</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">            <span style="color: #0000ff">while</span>((len = in.read(buffer))&gt;0){</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">                System.out.println(<span style="color: #0000ff">new</span> String(buffer,0,len));    <span style="color: #008000">//输出到控制台</span></pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">            }</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">        }<span style="color: #0000ff">finally</span>{</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">            <span style="color: #0000ff">if</span>(in!=null)</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">                <span style="color: #0000ff">try</span>{</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">                    in.close();</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">                }<span style="color: #0000ff">catch</span>(Exception e){</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">                }</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">        }</pre><!--CRLF--><pre style="text-align: left; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New', courier, monospace; direction: ltr; color: black; font-size: 10pt; overflow: visible; border-style: none; padding: 0px;">    } </pre><!--CRLF--></div></div><p>常用的一些HTTP协议请求头:</p><table style="width: 857px;" border="1" cellspacing="0" cellpadding="2"><tbody><tr height="20"><td width="150" valign="top"><p align="center">Request</p></td><td width="462" valign="top"><p align="center">GET /h.gif?pid=113&amp;monkey=cool HTTP/1.1</p></td><td width="243" valign="top"><p align="center">请求方式&nbsp; 请求路径&nbsp; 请求版本</p></td></tr><tr><td width="150" valign="top"><p align="center">Accept</p></td><td width="462" valign="top"><p align="center">image/png, image/svg+xml, image/*;q=0.8, */*;q=0.5</p></td><td width="243" valign="top"><p align="center">浏览器可接收的类型</p></td></tr><tr><td width="150" valign="top"><p align="center">Referer</p></td><td width="462" valign="top"><p align="center"><a target=_blank href="http://hao123.com/">http://hao123.com/</a></p></td><td width="243" valign="top"><p align="center">来源路径</p></td></tr><tr><td width="150" valign="top"><p align="center">Accept-Language</p></td><td width="462" valign="top"><p align="center">zh-CN</p></td><td width="243" valign="top"><p align="center">浏览器可以接收的语言</p></td></tr><tr><td width="150" valign="top"><p align="center">User-Agent</p></td><td style="width: 470px;" valign="top"><p align="center">Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)</p></td><td width="243" valign="top"><p align="center">浏览器的厂商信息</p></td></tr><tr><td width="150" valign="top"><p align="center">Content-Type </p></td><td width="462" valign="top"><p align="center">text/html; charset=UTF-8</p></td><td width="243" valign="top"><p align="center">数据的内容类型</p></td></tr><tr><td width="150" valign="top"><p align="center">Accept-Encoding</p></td><td width="462" valign="top"><p align="center">gzip, deflate</p></td><td width="243" valign="top"><p align="center">浏览器可以接收压缩后的数据</p></td></tr><tr><td width="150" valign="top"><p align="center">Host </p></td><td width="462" valign="top"><p align="center">nsclick.baidu.com</p></td><td width="243" valign="top"><p align="center">请求的主机IP和端口号</p></td></tr><tr><td width="150" valign="top"><p align="center">Content-Length</p></td><td width="462" valign="top"><p align="center">289</p></td><td width="243" valign="top"><p align="center">用于指定数据的总长度</p></td></tr><tr><td width="150" valign="top"><p align="center">Connection </p></td><td width="462" valign="top"><p align="center">Keep-Alive</p></td><td width="243" valign="top"><p align="center">维持一个活动连接</p></td></tr><tr><td width="150" valign="top"><p align="center">Cache-Control</p></td><td width="462" valign="top"><p align="center">no-cache</p></td><td width="243" valign="top"><p align="center">缓存情况</p></td></tr><tr><td width="150" valign="top"><p align="center">Cookie </p></td><td width="462" valign="top"><p align="center">BAIDUID=304614CF0781D6FABA00280E60983AF5:FG=1</p></td><td width="243" valign="top"><p align="center">COOKIE</p></td></tr></tbody></table>